import{_ as s,c as a,o as n,U as l}from"./chunks/framework.BWp8c4Qg.js";const e="/blog/assets/nat-cnV1Hg.Cx1GSWFM.png",p="/blog/assets/nat-q0LAns.CM8KwCYA.png",r="/blog/assets/nat-ngap0n.CuJzO19c.png",o="/blog/assets/nat-BfBZNa.BP0NLdd8.png",_=JSON.parse('{"title":"几种内网穿透姿势","description":"","frontmatter":{},"headers":[],"relativePath":"article/record/nat.md","filePath":"article/record/nat.md","lastUpdated":1711976187000}'),t={name:"article/record/nat.md"},c=l(`<h1 id="几种内网穿透姿势" tabindex="-1">几种内网穿透姿势 <a class="header-anchor" href="#几种内网穿透姿势" aria-label="Permalink to &quot;几种内网穿透姿势&quot;">​</a></h1><h2 id="什么是内网穿透" tabindex="-1">什么是内网穿透 <a class="header-anchor" href="#什么是内网穿透" aria-label="Permalink to &quot;什么是内网穿透&quot;">​</a></h2><p>内网穿透，即NAT穿透，网络连接时术语，计算机是局域网内时，外网与内网的计算机节点需要连接通信，有时就会出现不支持内网穿透。就是说映射端口，能让外网的电脑找到处于内网的电脑，提高下载速度。不管是内网穿透还是其他类型的网络穿透，都是网络穿透的统一方法来研究和解决。 简单来说就是：外网访问内网指定机器指定端口</p><h3 id="应用场景" tabindex="-1">应用场景 <a class="header-anchor" href="#应用场景" aria-label="Permalink to &quot;应用场景&quot;">​</a></h3><ul><li>提供内网穿透服务</li><li>连接内网服务器，在外网演示内网web站点</li><li>无需服务器部署，快速调试本地程序，微信公众号开发利器</li><li>支持http、https协议站点，省去证书中间件复杂配置，http协议站点直接升级为https站点</li><li>支持TCP，UDP协议端口转发。支持数据库、SSH、远程桌面、网络摄像头等等开放到外网</li></ul><h2 id="frp工具的使用" tabindex="-1">frp工具的使用 <a class="header-anchor" href="#frp工具的使用" aria-label="Permalink to &quot;frp工具的使用&quot;">​</a></h2><p>搭建稍微复杂，但是非常灵活，目前内网穿透首选了。<a href="https://github.com/fatedier/frp" target="_blank" rel="noreferrer">frp传送门</a></p><h3 id="需要的工具" tabindex="-1">需要的工具 <a class="header-anchor" href="#需要的工具" aria-label="Permalink to &quot;需要的工具&quot;">​</a></h3><ul><li><p>vps一台，随便什么云都可以</p></li><li><p>自己的终端</p></li></ul><h3 id="内网穿透实现web服务" tabindex="-1">内网穿透实现web服务 <a class="header-anchor" href="#内网穿透实现web服务" aria-label="Permalink to &quot;内网穿透实现web服务&quot;">​</a></h3><p>先登陆vps看看自己的处理器架构然后选择对应版本的frp</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#FFCB6B;">arch</span></span>
<span class="line"><span style="color:#FFCB6B;">//</span><span style="color:#C3E88D;"> x86_64</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>选择<a href="https://github.com/fatedier/frp/releases" target="_blank" rel="noreferrer">amd64版本(frp_0.33.0_linux_amd64.tar.gz)</a></p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#FFCB6B;">wget</span><span style="color:#C3E88D;"> https://github.com/fatedier/frp/releases/download/v0.33.0/frp_0.33.0_linux_amd64.tar.gz</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">//</span><span style="color:#C3E88D;"> 解压</span></span>
<span class="line"><span style="color:#FFCB6B;">tar</span><span style="color:#C3E88D;"> -zxvf</span><span style="color:#C3E88D;"> frp_0.33.0_linux_amd64.tar.gz</span></span>
<span class="line"><span style="color:#FFCB6B;">mv</span><span style="color:#C3E88D;"> frp_0.33.0_linux_amd64</span><span style="color:#C3E88D;"> frp</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">vim</span><span style="color:#C3E88D;"> frps.ini</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">//</span><span style="color:#C3E88D;"> 添加下面配置</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#BABED8;">common</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#FFCB6B;">bind_port</span><span style="color:#C3E88D;"> =</span><span style="color:#F78C6C;"> 7000</span></span>
<span class="line"><span style="color:#FFCB6B;">dashboard_port</span><span style="color:#C3E88D;"> =</span><span style="color:#F78C6C;"> 7001</span></span>
<span class="line"><span style="color:#FFCB6B;">token</span><span style="color:#C3E88D;"> =</span><span style="color:#C3E88D;"> superYue</span></span>
<span class="line"><span style="color:#FFCB6B;">dashboard_user</span><span style="color:#C3E88D;"> =</span><span style="color:#C3E88D;"> frp</span></span>
<span class="line"><span style="color:#FFCB6B;">dashboard_pwd</span><span style="color:#C3E88D;"> =</span><span style="color:#C3E88D;"> frp</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><ul><li>bind_port表示客户端和服务端连接的端口，默认是7000，需要跟客户端的bind_port保持一致。</li><li>dashboard_port是服务端仪表盘的端口，配置完成以后可以通过浏览器访问x.x.x.x:7500查看frp服务的dashborad。</li><li>token是用于客户端跟服务端连接的口令，连接口令，要跟客户端的token保持一致就行。</li><li>dashboard_user和dashboard_pwd表示打开仪表板页面登录的用户名和密码，登陆时候要用上。</li></ul><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#FFCB6B;">vim</span><span style="color:#C3E88D;"> frps.ini</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>添加如下配置：</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#89DDFF;">[</span><span style="color:#BABED8;">common</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#FFCB6B;">bind_port</span><span style="color:#C3E88D;"> =</span><span style="color:#F78C6C;"> 7000</span></span>
<span class="line"><span style="color:#FFCB6B;">token</span><span style="color:#C3E88D;"> =</span><span style="color:#C3E88D;"> superYue</span></span>
<span class="line"><span style="color:#FFCB6B;">vhost_http_port</span><span style="color:#C3E88D;"> =</span><span style="color:#F78C6C;"> 10080</span></span>
<span class="line"><span style="color:#FFCB6B;">vhost_https_port</span><span style="color:#C3E88D;"> =</span><span style="color:#F78C6C;"> 10443</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ul><li>bind_port表示客户端和服务端连接的端口，默认是7000，需要保持和客户端的bind_port一致。</li><li>token跟服务端设置的token保持一致。</li><li>vhost_http_port和vhost_https_port用于服务端主机访问的端口，需要再vps安全组里添加此端口，保持端口放行。</li></ul><h3 id="启动" tabindex="-1">启动 <a class="header-anchor" href="#启动" aria-label="Permalink to &quot;启动&quot;">​</a></h3><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#FFCB6B;">./frps</span><span style="color:#C3E88D;"> -c</span><span style="color:#C3E88D;"> frps.ini</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">//</span><span style="color:#C3E88D;"> 守护进程</span></span>
<span class="line"><span style="color:#FFCB6B;">nohup</span><span style="color:#C3E88D;"> ./frps</span><span style="color:#C3E88D;"> -c</span><span style="color:#C3E88D;"> frps.ini</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>打开配置的x.x.x.x:7500就可以看到仪表板截面。</p><p><img src="`+e+`" alt="img"></p><h3 id="客户端设置" tabindex="-1">客户端设置 <a class="header-anchor" href="#客户端设置" aria-label="Permalink to &quot;客户端设置&quot;">​</a></h3><p>安装同样版本的<code>frp</code>,安装方法一样，mac上面需要使用 <code>frp_0.33.0_darwin_amd64.tar.gz</code>这个版本</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#FFCB6B;">vim</span><span style="color:#C3E88D;"> frpc.ini</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#BABED8;">common</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#FFCB6B;">server_addr</span><span style="color:#C3E88D;"> =</span><span style="color:#C3E88D;"> xxxxx</span></span>
<span class="line"><span style="color:#FFCB6B;">server_port</span><span style="color:#C3E88D;"> =</span><span style="color:#F78C6C;"> 7000</span></span>
<span class="line"><span style="color:#FFCB6B;">token</span><span style="color:#C3E88D;"> =</span><span style="color:#C3E88D;"> superYue</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#BABED8;">web</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#82AAFF;">type</span><span style="color:#C3E88D;"> =</span><span style="color:#C3E88D;"> http</span></span>
<span class="line"><span style="color:#FFCB6B;">local_port</span><span style="color:#C3E88D;"> =</span><span style="color:#F78C6C;"> 9003</span></span>
<span class="line"><span style="color:#FFCB6B;">custom_domains</span><span style="color:#C3E88D;"> =</span><span style="color:#C3E88D;"> xx.xx.xx</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><ul><li>server_addr使用的是外网机器IP。</li><li>server_port服务端设置的端口。</li><li>local_port为本地客户端启动的web服务。</li><li>type为代理的类型，web服务设置为http类型。</li><li>custom_domains为外网VPS绑定的访问域名或者机器的IP。</li></ul><h3 id="启动客户端" tabindex="-1">启动客户端 <a class="header-anchor" href="#启动客户端" aria-label="Permalink to &quot;启动客户端&quot;">​</a></h3><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#FFCB6B;">./frpc</span><span style="color:#C3E88D;"> -c</span><span style="color:#C3E88D;"> frpc.ini</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">//</span><span style="color:#C3E88D;"> 守护进程</span></span>
<span class="line"><span style="color:#FFCB6B;">nohup</span><span style="color:#C3E88D;"> ./frpc</span><span style="color:#C3E88D;"> -c</span><span style="color:#C3E88D;"> frpsc.ini</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>启动成功之后，使用外网IP或者域名:vhost_http_port，即custom_domains:10080，就可以通过外网的访问自己内网/本地启动的web服务了。</p><h3 id="内网穿透实现ssh连接" tabindex="-1">内网穿透实现SSH连接 <a class="header-anchor" href="#内网穿透实现ssh连接" aria-label="Permalink to &quot;内网穿透实现SSH连接&quot;">​</a></h3><p>配置 frpc.ini</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#FFCB6B;">vim</span><span style="color:#C3E88D;"> frpc.ini</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#BABED8;">common</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#FFCB6B;">xxx/</span><span style="color:#C3E88D;"> 不赘述了</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#BABED8;">ssh</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#82AAFF;">type</span><span style="color:#C3E88D;"> =</span><span style="color:#C3E88D;"> tcp</span></span>
<span class="line"><span style="color:#FFCB6B;">local_ip</span><span style="color:#C3E88D;"> =</span><span style="color:#F78C6C;"> 127.0</span><span style="color:#C3E88D;">.0.1</span></span>
<span class="line"><span style="color:#FFCB6B;">local_port</span><span style="color:#C3E88D;"> =</span><span style="color:#F78C6C;"> 22</span></span>
<span class="line"><span style="color:#FFCB6B;">remote_port</span><span style="color:#C3E88D;"> =</span><span style="color:#F78C6C;"> 8001</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><ul><li>server_addr就是你公网服务器的IP。</li><li>server_port服务端设置的端口。</li><li>token跟服务端设置的token保持一致即可。</li><li>type为代理的类型，SSH服务设置为tcp类型。</li><li>local_ip为本地IP。</li><li>local_port为内网客户端设置的SSH端口。</li><li>remote_port为内网提供给外网访问的服务端口。</li></ul><p>启动方式跟穿透Web服务一样，这样我可以通过服务器公网IP和8001端口来连接本地的机器了（SSH）。</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#FFCB6B;">ssh</span><span style="color:#C3E88D;"> -p</span><span style="color:#C3E88D;"> remote_port</span><span style="color:#C3E88D;"> username@server_addr</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><ul><li>remote_port使用的是内网机器设置的端口。</li><li>username使用的是内网机器的用户名。</li><li>server_addr使用的是外网机器IP。</li></ul><p>frp还有很多其他协议支持，<code>tcp</code>,<code>udp</code>,<code>http</code>,<code>https</code>,<code>stcp</code>, 但是frp的配置方式稍微繁琐，并且需要有自己的vps，下面介绍的工具就非常简单了。</p><h2 id="ngrok工具的使用" tabindex="-1">ngrok工具的使用 <a class="header-anchor" href="#ngrok工具的使用" aria-label="Permalink to &quot;ngrok工具的使用&quot;">​</a></h2><p>打开ngrok官网注册一个账号后登录，<a href="https://dashboard.ngrok.com" target="_blank" rel="noreferrer">ngrok官网</a></p><h3 id="下载客户端" tabindex="-1">下载客户端 <a class="header-anchor" href="#下载客户端" aria-label="Permalink to &quot;下载客户端&quot;">​</a></h3><p><img src="`+p+`" alt="img"></p><h3 id="配置客户端authtoken" tabindex="-1">配置客户端authtoken <a class="header-anchor" href="#配置客户端authtoken" aria-label="Permalink to &quot;配置客户端authtoken&quot;">​</a></h3><p>首页基本给了你想要的一切</p><blockquote><p>command 方式</p></blockquote><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#FFCB6B;">./ngrok</span><span style="color:#C3E88D;"> authtoken</span><span style="color:#C3E88D;"> xxxx</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><blockquote><p>config 方式</p></blockquote><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#82AAFF;">cd</span><span style="color:#C3E88D;"> ~/.ngrok2/ngrok.yml</span></span>
<span class="line"><span style="color:#FFCB6B;">authtoken:</span><span style="color:#C3E88D;"> xxxxx</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="开始做内网穿透" tabindex="-1">开始做内网穿透 <a class="header-anchor" href="#开始做内网穿透" aria-label="Permalink to &quot;开始做内网穿透&quot;">​</a></h3><p><img src="`+r+'" alt="img"></p><p>假设你在本机上启动了一个端口号为8000的服务，使用内网穿透工具将当前8000端口的服务映射到外网去。 打开ngrok客户端</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#FFCB6B;">ngrok</span><span style="color:#C3E88D;"> http</span><span style="color:#F78C6C;"> 8000</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p><img src="'+o+'" alt="img"></p><p>这样就可通过外网访问 <code>http://24a2c2f8390e.ngrok.io</code> 自己内网的服务啦,是不是非常简单。但是比frp搭建少了一些灵活性，但是不能自定义域名之类的，用来临时处理一下内网穿透需求还是很方便的。</p><h2 id="小结" tabindex="-1">小结 <a class="header-anchor" href="#小结" aria-label="Permalink to &quot;小结&quot;">​</a></h2><p>当然内网穿透的姿势远不至这些，有兴趣的话自己研究把，希望上面的内容可以帮到大家。</p>',56),i=[c];function d(b,u,h,m,y,C){return n(),a("div",null,i)}const B=s(t,[["render",d]]);export{_ as __pageData,B as default};
