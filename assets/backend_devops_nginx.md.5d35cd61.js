import{_ as s,o as n,c as a,a as l}from"./app.b1a3c5cb.js";const b=JSON.parse('{"title":"nginx","description":"","frontmatter":{},"headers":[{"level":2,"title":"\u5B89\u88C5","slug":"\u5B89\u88C5","link":"#\u5B89\u88C5","children":[{"level":3,"title":"\u4E0B\u8F7Dnginx\u6E90\u7801","slug":"\u4E0B\u8F7Dnginx\u6E90\u7801","link":"#\u4E0B\u8F7Dnginx\u6E90\u7801","children":[]},{"level":3,"title":"\u5B89\u88C5\u64CD\u4F5C","slug":"\u5B89\u88C5\u64CD\u4F5C","link":"#\u5B89\u88C5\u64CD\u4F5C","children":[]},{"level":3,"title":"\u73AF\u5883\u53D8\u91CF","slug":"\u73AF\u5883\u53D8\u91CF","link":"#\u73AF\u5883\u53D8\u91CF","children":[]}]},{"level":2,"title":"\u5E38\u7528\u914D\u7F6E","slug":"\u5E38\u7528\u914D\u7F6E","link":"#\u5E38\u7528\u914D\u7F6E","children":[{"level":3,"title":"\u9879\u76EE\u914D\u7F6E(http)","slug":"\u9879\u76EE\u914D\u7F6E-http","link":"#\u9879\u76EE\u914D\u7F6E-http","children":[]},{"level":3,"title":"\u9879\u76EE\u914D\u7F6E(https)","slug":"\u9879\u76EE\u914D\u7F6E-https","link":"#\u9879\u76EE\u914D\u7F6E-https","children":[]},{"level":3,"title":"api\u670D\u52A1https\u914D\u7F6E","slug":"api\u670D\u52A1https\u914D\u7F6E","link":"#api\u670D\u52A1https\u914D\u7F6E","children":[]},{"level":3,"title":"history\u8DEF\u7531\u914D\u7F6E","slug":"history\u8DEF\u7531\u914D\u7F6E","link":"#history\u8DEF\u7531\u914D\u7F6E","children":[]},{"level":3,"title":"\u9759\u6001\u6587\u4EF6\u6821\u9A8C","slug":"\u9759\u6001\u6587\u4EF6\u6821\u9A8C","link":"#\u9759\u6001\u6587\u4EF6\u6821\u9A8C","children":[]}]},{"level":2,"title":"certbot\u5B89\u88C5https","slug":"certbot\u5B89\u88C5https","link":"#certbot\u5B89\u88C5https","children":[]},{"level":2,"title":"Nginx \u4F18\u52BF","slug":"nginx-\u4F18\u52BF","link":"#nginx-\u4F18\u52BF","children":[]},{"level":2,"title":"Nginx \u4E3B\u8981\u5E94\u7528\u573A\u666F","slug":"nginx-\u4E3B\u8981\u5E94\u7528\u573A\u666F","link":"#nginx-\u4E3B\u8981\u5E94\u7528\u573A\u666F","children":[]},{"level":2,"title":"\u6B63\u5411\u4EE3\u7406 Forward proxy","slug":"\u6B63\u5411\u4EE3\u7406-forward-proxy","link":"#\u6B63\u5411\u4EE3\u7406-forward-proxy","children":[]},{"level":2,"title":"\u53CD\u5411\u4EE3\u7406 Reverse proxy","slug":"\u53CD\u5411\u4EE3\u7406-reverse-proxy","link":"#\u53CD\u5411\u4EE3\u7406-reverse-proxy","children":[]},{"level":2,"title":"Gzip","slug":"gzip","link":"#gzip","children":[]},{"level":2,"title":"\u8BF7\u6C42\u9650\u5236","slug":"\u8BF7\u6C42\u9650\u5236","link":"#\u8BF7\u6C42\u9650\u5236","children":[]},{"level":2,"title":"\u8BBF\u95EE\u63A7\u5236","slug":"\u8BBF\u95EE\u63A7\u5236","link":"#\u8BBF\u95EE\u63A7\u5236","children":[]},{"level":2,"title":"\u9632\u76D7\u94FE","slug":"\u9632\u76D7\u94FE","link":"#\u9632\u76D7\u94FE","children":[]},{"level":2,"title":"\u8D1F\u8F7D\u5747\u8861 Load Balance","slug":"\u8D1F\u8F7D\u5747\u8861-load-balance","link":"#\u8D1F\u8F7D\u5747\u8861-load-balance","children":[{"level":3,"title":"\u540E\u7AEF\u670D\u52A1\u5668\u72B6\u6001","slug":"\u540E\u7AEF\u670D\u52A1\u5668\u72B6\u6001","link":"#\u540E\u7AEF\u670D\u52A1\u5668\u72B6\u6001","children":[]},{"level":3,"title":"\u5206\u914D\u65B9\u5F0F","slug":"\u5206\u914D\u65B9\u5F0F","link":"#\u5206\u914D\u65B9\u5F0F","children":[]}]}],"relativePath":"backend/devops/nginx.md","lastUpdated":1668872608000}'),p={name:"backend/devops/nginx.md"},e=l(`<h1 id="nginx" tabindex="-1">nginx <a class="header-anchor" href="#nginx" aria-hidden="true">#</a></h1><p>CPU \u671D\u7740\u591A\u6838\u65B9\u5411\u53D1\u5C55\uFF0C\u4E4B\u524D\u7684\u9738\u4E3B Apache \u4E00\u4E2A\u8FDB\u7A0B\u540C\u4E00\u65F6\u95F4\u53EA\u80FD\u5904\u7406\u4E00\u4E2A\u8FDE\u63A5\uFF0C\u5904\u7406\u5B8C\u4E00\u4E2A\u8BF7\u6C42\u540E\u624D\u80FD\u5904\u7406\u4E0B\u4E00\u4E2A\uFF0C\u8FD9\u65E0\u7591\u4E0D\u80FD\u5E94\u5BF9\u5982\u4ECA\u4E92\u8054\u7F51\u4E0A\u6D77\u91CF\u7684\u7528\u6237\u3002\u51B5\u4E14\u8FDB\u7A0B\u95F4\u5207\u6362\u7684\u6210\u672C\u662F\u975E\u5E38\u9AD8\u7684\u3002\u5728\u8FD9\u79CD\u80CC\u666F\u4E0B\uFF0CNginx \u5E94\u8FD0\u800C\u751F\uFF0C\u53EF\u4EE5\u8F7B\u677E\u5904\u7406\u6570\u767E\u4E07\u3001\u4E0A\u5343\u4E07\u7684\u8FDE\u63A5\u3002</p><h2 id="\u5B89\u88C5" tabindex="-1">\u5B89\u88C5 <a class="header-anchor" href="#\u5B89\u88C5" aria-hidden="true">#</a></h2><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki"><code><span class="line"><span style="color:#676E95;">#gcc\u5B89\u88C5\uFF0Cnginx\u6E90\u7801\u7F16\u8BD1\u9700\u8981</span></span>
<span class="line"><span style="color:#A6ACCD;">yum install gcc-c++</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">#PCRE pcre-devel \u5B89\u88C5\uFF0Cnginx \u7684 http \u6A21\u5757\u4F7F\u7528 pcre \u6765\u89E3\u6790\u6B63\u5219\u8868\u8FBE\u5F0F</span></span>
<span class="line"><span style="color:#A6ACCD;">yum install -y pcre pcre-devel</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">#zlib\u5B89\u88C5\uFF0Cnginx \u4F7F\u7528zlib\u5BF9http\u5305\u7684\u5185\u5BB9\u8FDB\u884Cgzip</span></span>
<span class="line"><span style="color:#A6ACCD;">yum install -y zlib zlib-devel</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">#OpenSSL \u5B89\u88C5\uFF0C\u5F3A\u5927\u7684\u5B89\u5168\u5957\u63A5\u5B57\u5C42\u5BC6\u7801\u5E93\uFF0Cnginx \u4E0D\u4EC5\u652F\u6301 http \u534F\u8BAE\uFF0C\u8FD8\u652F\u6301 https\uFF08\u5373\u5728ssl\u534F\u8BAE\u4E0A\u4F20\u8F93http\uFF09</span></span>
<span class="line"><span style="color:#A6ACCD;">yum install -y openssl openssl-devel</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="\u4E0B\u8F7Dnginx\u6E90\u7801" tabindex="-1">\u4E0B\u8F7Dnginx\u6E90\u7801 <a class="header-anchor" href="#\u4E0B\u8F7Dnginx\u6E90\u7801" aria-hidden="true">#</a></h3><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki"><code><span class="line"><span style="color:#A6ACCD;">wget -c https://nginx.org/download/nginx-1.16.1.tar.gz //\u627E\u5230\u81EA\u5DF1\u9700\u8981\u7684\u7248\u672C</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="\u5B89\u88C5\u64CD\u4F5C" tabindex="-1">\u5B89\u88C5\u64CD\u4F5C <a class="header-anchor" href="#\u5B89\u88C5\u64CD\u4F5C" aria-hidden="true">#</a></h3><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki"><code><span class="line"><span style="color:#676E95;">#\u6839\u76EE\u5F55\u4F7F\u7528ls\u547D\u4EE4\u53EF\u4EE5\u770B\u5230\u4E0B\u8F7D\u7684nginx\u538B\u7F29\u5305\uFF0C\u7136\u540E\u89E3\u538B</span></span>
<span class="line"><span style="color:#A6ACCD;">tar -zxvf nginx-1.16.1.tar.gz</span></span>
<span class="line"><span style="color:#676E95;">#\u89E3\u538B\u540E\u8FDB\u5165\u76EE\u5F55</span></span>
<span class="line"><span style="color:#82AAFF;">cd</span><span style="color:#A6ACCD;"> nginx-1.16.1</span></span>
<span class="line"><span style="color:#676E95;">#\u4F7F\u7528\u9ED8\u8BA4\u914D\u7F6E</span></span>
<span class="line"><span style="color:#A6ACCD;">./configure</span></span>
<span class="line"><span style="color:#676E95;"># https\u6A21\u5757\u5B89\u88C5</span></span>
<span class="line"><span style="color:#A6ACCD;">./configure --with-http_stub_status_module --with-http_ssl_module</span></span>
<span class="line"><span style="color:#676E95;">#\u7F16\u8BD1\u5B89\u88C5</span></span>
<span class="line"><span style="color:#A6ACCD;">make</span></span>
<span class="line"><span style="color:#A6ACCD;">make install</span></span>
<span class="line"><span style="color:#676E95;">#\u67E5\u627E\u5B89\u88C5\u8DEF\u5F84\uFF0C\u9ED8\u8BA4\u90FD\u662F\u8FD9\u4E2A\u8DEF\u5F84</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@VM_0_12_centos </span><span style="color:#89DDFF;">~]</span><span style="color:#676E95;"># whereis nginx</span></span>
<span class="line"><span style="color:#A6ACCD;">nginx: /usr/local/nginx</span></span>
<span class="line"><span style="color:#676E95;">#\u542F\u52A8\u3001\u505C\u6B62nginx</span></span>
<span class="line"><span style="color:#82AAFF;">cd</span><span style="color:#A6ACCD;"> /usr/local/nginx/sbin/</span></span>
<span class="line"><span style="color:#A6ACCD;">./nginx     </span><span style="color:#676E95;">#\u542F\u52A8</span></span>
<span class="line"><span style="color:#A6ACCD;">./nginx -s stop  </span><span style="color:#676E95;">#\u505C\u6B62\uFF0C\u76F4\u63A5\u67E5\u627Enginx\u8FDB\u7A0Bid\u518D\u4F7F\u7528kill\u547D\u4EE4\u5F3A\u5236\u6740\u6389\u8FDB\u7A0B</span></span>
<span class="line"><span style="color:#A6ACCD;">./nginx -s quit  </span><span style="color:#676E95;">#\u9000\u51FA\u505C\u6B62\uFF0C\u7B49\u5F85nginx\u8FDB\u7A0B\u5904\u7406\u5B8C\u4EFB\u52A1\u518D\u8FDB\u884C\u505C\u6B62</span></span>
<span class="line"><span style="color:#A6ACCD;">./nginx -s reload  </span><span style="color:#676E95;">#\u91CD\u65B0\u52A0\u8F7D\u914D\u7F6E\u6587\u4EF6\uFF0C\u4FEE\u6539nginx.conf\u540E\u4F7F\u7528\u8BE5\u547D\u4EE4\uFF0C\u65B0\u914D\u7F6E\u5373\u53EF\u751F\u6548</span></span>
<span class="line"><span style="color:#676E95;">#\u91CD\u542Fnginx\uFF0C\u5EFA\u8BAE\u5148\u505C\u6B62\uFF0C\u518D\u542F\u52A8</span></span>
<span class="line"><span style="color:#A6ACCD;">./nginx -s stop</span></span>
<span class="line"><span style="color:#A6ACCD;">./nginx</span></span>
<span class="line"><span style="color:#89DDFF;"> </span><span style="color:#676E95;">#\u67E5\u770Bnginx\u8FDB\u7A0B\uFF0C\u5982\u4E0B\u8FD4\u56DE\uFF0C\u5373\u4E3A\u6210\u529F</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@VM_0_12_centos </span><span style="color:#89DDFF;">~]</span><span style="color:#676E95;"># ps aux|grep nginx</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><h3 id="\u73AF\u5883\u53D8\u91CF" tabindex="-1">\u73AF\u5883\u53D8\u91CF <a class="header-anchor" href="#\u73AF\u5883\u53D8\u91CF" aria-hidden="true">#</a></h3><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki"><code><span class="line"><span style="color:#C792EA;">export</span><span style="color:#A6ACCD;"> NGINX_HOME=/usr/local/nginx</span></span>
<span class="line"><span style="color:#C792EA;">export</span><span style="color:#A6ACCD;"> PATH=</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">PATH:</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">NGINX_HOME/sbin</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="\u5E38\u7528\u914D\u7F6E" tabindex="-1">\u5E38\u7528\u914D\u7F6E <a class="header-anchor" href="#\u5E38\u7528\u914D\u7F6E" aria-hidden="true">#</a></h2><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki"><code><span class="line"><span style="color:#A6ACCD;">server </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  listen 80</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  server_name  code.limchihi.cn</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  location / </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    proxy_pass http://127.0.0.1:3000/</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="\u9879\u76EE\u914D\u7F6E-http" tabindex="-1">\u9879\u76EE\u914D\u7F6E(http) <a class="header-anchor" href="#\u9879\u76EE\u914D\u7F6E-http" aria-hidden="true">#</a></h3><div class="language-nginx line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki"><code><span class="line"><span style="color:#C792EA;">server</span><span style="color:#A6ACCD;"> {</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> set $</span><span style="color:#A6ACCD;">myRoot = /root/fe/stage</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> set $</span><span style="color:#A6ACCD;">myServerName = xxxx</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> set $</span><span style="color:#A6ACCD;">proxyApi = http://api.ynoo.net/api</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> listen </span><span style="color:#A6ACCD;">      </span><span style="color:#F78C6C;">80</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> server_name </span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">myServerName</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">rewrite</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">^/(.*) https://$</span><span style="color:#A6ACCD;">server_name</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">1 </span><span style="color:#F78C6C;">permanent</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> root $</span><span style="color:#A6ACCD;">myRoot</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">/ </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">     </span><span style="color:#89DDFF;"> try_files $</span><span style="color:#A6ACCD;">uri </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">uri/ /index.html </span><span style="color:#F78C6C;">=404</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">/adminAPI </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">     </span><span style="color:#89DDFF;"> proxy_pass $</span><span style="color:#A6ACCD;">proxyApi</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> error_page </span><span style="color:#A6ACCD;">  </span><span style="color:#F78C6C;">500</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">502</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">503</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">504</span><span style="color:#A6ACCD;">  /50x.html</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/50x.html </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">     </span><span style="color:#89DDFF;"> root </span><span style="color:#A6ACCD;">  html</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    }</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><h3 id="\u9879\u76EE\u914D\u7F6E-https" tabindex="-1">\u9879\u76EE\u914D\u7F6E(https) <a class="header-anchor" href="#\u9879\u76EE\u914D\u7F6E-https" aria-hidden="true">#</a></h3><div class="language-nginx line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki"><code><span class="line"><span style="color:#C792EA;">server</span><span style="color:#A6ACCD;"> {</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> set $</span><span style="color:#A6ACCD;">myServerName = xxxx</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> listen </span><span style="color:#A6ACCD;">      </span><span style="color:#F78C6C;">80</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> server_name </span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">myServerName</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">rewrite</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">^/(.*) https://$</span><span style="color:#A6ACCD;">server_name</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">1 </span><span style="color:#F78C6C;">permanent</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">server</span><span style="color:#A6ACCD;"> {</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> set $</span><span style="color:#A6ACCD;">myRoot = /root/fe/stage</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> set $</span><span style="color:#A6ACCD;">myServerName = ms.ynoo.net</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> set $</span><span style="color:#A6ACCD;">myNginxConfRoot = /usr/local/nginx/server/cert</span></span>
<span class="line"><span style="color:#A6ACCD;">    set </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">proxyApi = http://api.ynoo.net/api</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> listen </span><span style="color:#A6ACCD;">      </span><span style="color:#F78C6C;">443</span><span style="color:#A6ACCD;"> ssl</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> server_name </span><span style="color:#A6ACCD;"> xxzk.ynoo.net</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> ssl_certificate </span><span style="color:#A6ACCD;">     </span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">myNginxConfRoot</span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">/</span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">myServerName</span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">/index.pem</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> ssl_certificate_key </span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">myNginxConfRoot</span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">/</span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">myServerName</span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">/index.key</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> keepalive_timeout </span><span style="color:#A6ACCD;">100</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> ssl_session_cache </span><span style="color:#A6ACCD;">   shared:SSL:5m</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> ssl_session_timeout </span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">5m</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> ssl_ciphers </span><span style="color:#A6ACCD;"> HIGH:!aNULL:!MD5</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> ssl_prefer_server_ciphers  on;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">/ </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">     </span><span style="color:#89DDFF;"> try_files $</span><span style="color:#A6ACCD;">uri </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">uri/ /index.html </span><span style="color:#F78C6C;">=404</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">/adminAPI </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">     </span><span style="color:#89DDFF;"> proxy_pass $</span><span style="color:#A6ACCD;">proxyApi</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> error_page </span><span style="color:#A6ACCD;">  </span><span style="color:#F78C6C;">500</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">502</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">503</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">504</span><span style="color:#A6ACCD;">  /50x.html</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/50x.html </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">     </span><span style="color:#89DDFF;"> root </span><span style="color:#A6ACCD;">  html</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    }</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br></div></div><h3 id="api\u670D\u52A1https\u914D\u7F6E" tabindex="-1">api\u670D\u52A1https\u914D\u7F6E <a class="header-anchor" href="#api\u670D\u52A1https\u914D\u7F6E" aria-hidden="true">#</a></h3><div class="language-nginx line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki"><code><span class="line"><span style="color:#C792EA;">server</span><span style="color:#A6ACCD;"> {</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> listen </span><span style="color:#A6ACCD;">      </span><span style="color:#F78C6C;">80</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> server_name </span><span style="color:#A6ACCD;"> xxzk.ynoo.net</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">/ </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">       </span><span style="color:#89DDFF;"> proxy_pass </span><span style="color:#A6ACCD;">http://localhost:7001/</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">       </span><span style="color:#89DDFF;"> proxy_http_version </span><span style="color:#A6ACCD;">1.1</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">       </span><span style="color:#89DDFF;"> proxy_set_header </span><span style="color:#A6ACCD;">Upgrade </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">http_upgrade</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">       </span><span style="color:#89DDFF;"> proxy_set_header </span><span style="color:#A6ACCD;">Connection </span><span style="color:#C3E88D;">&#39;upgrade&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">       </span><span style="color:#89DDFF;"> proxy_set_header </span><span style="color:#A6ACCD;">Host </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">host</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">       </span><span style="color:#89DDFF;"> proxy_cache_bypass $</span><span style="color:#A6ACCD;">http_upgrade</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    }</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#C792EA;">server</span><span style="color:#A6ACCD;"> {</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> listen </span><span style="color:#A6ACCD;">      </span><span style="color:#F78C6C;">443</span><span style="color:#A6ACCD;"> ssl</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> server_name </span><span style="color:#A6ACCD;"> xxzk.ynoo.net</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> ssl_certificate </span><span style="color:#A6ACCD;">     /usr/local/nginx/server/cert/xxzk.ynoo.net/index.pem</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> ssl_certificate_key </span><span style="color:#A6ACCD;"> /usr/local/nginx/server/cert/xxzk.ynoo.net/index.key</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> keepalive_timeout </span><span style="color:#A6ACCD;">100</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> ssl_session_cache </span><span style="color:#A6ACCD;">   shared:SSL:5m</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> ssl_session_timeout </span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">5m</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> ssl_ciphers </span><span style="color:#A6ACCD;"> HIGH:!aNULL:!MD5</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> ssl_prefer_server_ciphers  on;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">/ </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">       </span><span style="color:#89DDFF;"> proxy_set_header </span><span style="color:#A6ACCD;">X-Real-IP </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">remote_addr</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">       </span><span style="color:#89DDFF;"> proxy_set_header </span><span style="color:#A6ACCD;">X-Real-Port </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">remote_port</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">       </span><span style="color:#89DDFF;"> proxy_pass </span><span style="color:#A6ACCD;">http://127.0.0.1:7001</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">       </span><span style="color:#89DDFF;"> proxy_pass_request_headers </span><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;"> on;</span></span>
<span class="line"><span style="color:#A6ACCD;">    }</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><h3 id="history\u8DEF\u7531\u914D\u7F6E" tabindex="-1">history\u8DEF\u7531\u914D\u7F6E <a class="header-anchor" href="#history\u8DEF\u7531\u914D\u7F6E" aria-hidden="true">#</a></h3><div class="language-nginx line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki"><code><span class="line"><span style="color:#C792EA;">server</span><span style="color:#A6ACCD;"> {</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> listen </span><span style="color:#A6ACCD;">     </span><span style="color:#F78C6C;">80</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> server_name </span><span style="color:#A6ACCD;"> localhost</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> index </span><span style="color:#A6ACCD;"> index.html index.htm</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> root </span><span style="color:#A6ACCD;">/xxx/xxx</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">/ </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">     </span><span style="color:#89DDFF;"> try_files $</span><span style="color:#A6ACCD;">uri </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">uri/ /index.html </span><span style="color:#F78C6C;">=404</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    }</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="\u9759\u6001\u6587\u4EF6\u6821\u9A8C" tabindex="-1">\u9759\u6001\u6587\u4EF6\u6821\u9A8C <a class="header-anchor" href="#\u9759\u6001\u6587\u4EF6\u6821\u9A8C" aria-hidden="true">#</a></h3><div class="language-nginx line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki"><code><span class="line"><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/jt0lp6bkO2.txt </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> default_type </span><span style="color:#A6ACCD;">text/plain</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">return</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">200</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">&#39;8e2bffc79f0305e793dd1e17f6aa6a43&#39;</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">#\u7981\u6B62\u8BBF\u95EE\u7684\u6587\u4EF6\u6216\u76EE\u5F55</span></span>
<span class="line"><span style="color:#89DDFF;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">~</span><span style="color:#A6ACCD;"> ^/(\\.user.ini|\\.htaccess|\\.git|\\.svn|\\.project|LICENSE|README.md)</span></span>
<span class="line"><span style="color:#F07178;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">404</span><span style="color:#F07178;">;</span></span>
<span class="line"><span style="color:#F07178;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">~</span><span style="color:#A6ACCD;"> .*\\.(gif|jpg|jpeg|png|bmp|swf)$</span></span>
<span class="line"><span style="color:#F07178;">{</span></span>
<span class="line"><span style="color:#F07178;"> </span><span style="color:#89DDFF;"> expires </span><span style="color:#F07178;">  </span><span style="color:#F78C6C;">30d</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;"> </span><span style="color:#89DDFF;"> error_log </span><span style="color:#F07178;">off</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;"> </span><span style="color:#89DDFF;"> access_log </span><span style="color:#F07178;">/dev/null</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">~</span><span style="color:#A6ACCD;"> .*\\.(js|css)?$</span></span>
<span class="line"><span style="color:#F07178;">{</span></span>
<span class="line"><span style="color:#F07178;"> </span><span style="color:#89DDFF;"> expires </span><span style="color:#F07178;">  </span><span style="color:#F78C6C;">12h</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;"> </span><span style="color:#89DDFF;"> error_log </span><span style="color:#F07178;">off</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;"> </span><span style="color:#89DDFF;"> access_log </span><span style="color:#F07178;">/dev/null</span><span style="color:#89DDFF;">;</span><span style="color:#F07178;"> </span></span>
<span class="line"><span style="color:#F07178;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><h2 id="certbot\u5B89\u88C5https" tabindex="-1">certbot\u5B89\u88C5https <a class="header-anchor" href="#certbot\u5B89\u88C5https" aria-hidden="true">#</a></h2><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki"><code><span class="line"><span style="color:#A6ACCD;">//\u5B89\u88C5</span></span>
<span class="line"><span style="color:#A6ACCD;">sudo yum install certbot python2-certbot-nginx</span></span>
<span class="line"><span style="color:#A6ACCD;">//\u542F\u52A8</span></span>
<span class="line"><span style="color:#A6ACCD;">// nginx.conf\u8DEF\u5F84</span></span>
<span class="line"><span style="color:#A6ACCD;">certbot --nginx --nginx-server-root=/usr/local/nginx/conf</span></span>
<span class="line"><span style="color:#A6ACCD;">//\u81EA\u52A8\u66F4\u65B0</span></span>
<span class="line"><span style="color:#82AAFF;">echo</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">0 0,12 * * * root python -c &#39;import random; import time; time.sleep(random.random() * 3600)&#39; &amp;&amp; certbot renew -q</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> sudo tee -a /etc/crontab </span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> /dev/null</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h2 id="nginx-\u4F18\u52BF" tabindex="-1">Nginx \u4F18\u52BF <a class="header-anchor" href="#nginx-\u4F18\u52BF" aria-hidden="true">#</a></h2><ul><li>\u9AD8\u5E76\u53D1\u9AD8\u6027\u80FD</li><li>\u53EF\u6269\u5C55\u6027\u597D</li><li>\u9AD8\u53EF\u9760\u6027</li><li>\u70ED\u90E8\u7F72</li></ul><h2 id="nginx-\u4E3B\u8981\u5E94\u7528\u573A\u666F" tabindex="-1">Nginx \u4E3B\u8981\u5E94\u7528\u573A\u666F <a class="header-anchor" href="#nginx-\u4E3B\u8981\u5E94\u7528\u573A\u666F" aria-hidden="true">#</a></h2><ul><li>\u9759\u6001\u8D44\u6E90\u670D\u52A1\uFF0C\u901A\u8FC7\u672C\u5730\u6587\u4EF6\u7CFB\u7EDF\u63D0\u4F9B\u670D\u52A1</li><li>\u53CD\u5411\u4EE3\u7406\u670D\u52A1\u3001\u8D1F\u8F7D\u5747\u8861</li><li>API \u670D\u52A1\u3001\u6743\u9650\u63A7\u5236\uFF0C\u51CF\u5C11\u5E94\u7528\u670D\u52A1\u5668\u538B\u529B</li><li>\u7F51\u5173\u670D\u52A1</li></ul><h2 id="\u6B63\u5411\u4EE3\u7406-forward-proxy" tabindex="-1">\u6B63\u5411\u4EE3\u7406 Forward proxy <a class="header-anchor" href="#\u6B63\u5411\u4EE3\u7406-forward-proxy" aria-hidden="true">#</a></h2><p>\u6B63\u5411\u4EE3\u7406\u7684\u5BF9\u8C61\u65F6\u5BA2\u6237\u7AEF\uFF0C\u670D\u52A1\u7AEF\u770B\u4E0D\u5230\u771F\u6B63\u7684\u5BA2\u6237\u7AEF\u3002</p><div class="language-nginx line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki"><code><span class="line"><span style="color:#89DDFF;">server</span><span style="color:#A6ACCD;">\xA0{\xA0</span></span>
<span class="line"><span style="color:#A6ACCD;">  location\xA0/\xA0{\xA0\xA0\xA0\xA0\xA0</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;">#\xA0\u5F53\u5BA2\u6237\u7AEF\u8BF7\u6C42\u6211\u7684\u65F6\u5019\uFF0C\u6211\u4F1A\u628A\u8BF7\u6C42\u8F6C\u53D1\u7ED9\u5B83\xA0\xA0\xA0\xA0\xA0\xA0</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;">#\xA0$http_host\xA0\u8981\u8BBF\u95EE\u7684\u4E3B\u673A\u540D\xA0$request_uri\xA0\u8BF7\u6C42\u8DEF\u5F84\xA0\xA0\xA0\xA0\xA0\xA0</span></span>
<span class="line"><span style="color:#A6ACCD;">    proxy_pass\xA0http://</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">http_host</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">request_uri;</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h2 id="\u53CD\u5411\u4EE3\u7406-reverse-proxy" tabindex="-1">\u53CD\u5411\u4EE3\u7406 Reverse proxy <a class="header-anchor" href="#\u53CD\u5411\u4EE3\u7406-reverse-proxy" aria-hidden="true">#</a></h2><p>\u89E3\u51B3\u8DE8\u57DF\u95EE\u9898\uFF0C\u5728\u751F\u4EA7\u4E2D\uFF0C\u53EF\u4EE5\u4F7F\u7528nginx\u7684\u53CD\u5411\u4EE3\u7406\u6765\u89E3\u51B3\u8DE8\u57DF\uFF1A</p><div class="language-nginx line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki"><code><span class="line"><span style="color:#89DDFF;">server</span><span style="color:#A6ACCD;">\xA0{\xA0\xA0\xA0\xA0</span></span>
<span class="line"><span style="color:#A6ACCD;">  listen\xA0\xA0\xA080;\xA0\xA0\xA0\xA0</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> server_name\xA0</span><span style="color:#A6ACCD;">\xA0\xA0localhost</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;">\xA0</span><span style="color:#676E95;">#\xA0\u7528\u6237\u8BBF\u95EE\xA0localhost\uFF0C\u53CD\u5411\u4EE3\u7406\u5230\xA0http://www.baidu.com</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">location</span><span style="color:#A6ACCD;">\xA0/\xA0{\xA0\xA0\xA0\xA0\xA0\xA0\xA0\xA0</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> proxy_pass\xA0</span><span style="color:#A6ACCD;">http://www.baidu.com</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h2 id="gzip" tabindex="-1">Gzip <a class="header-anchor" href="#gzip" aria-hidden="true">#</a></h2><p>gzip \u662F\u4E92\u8054\u7F51\u4E0A\u975E\u5E38\u666E\u904D\u7684\u4E00\u79CD\u6570\u636E\u538B\u7F29\u683C\u5F0F\uFF0C\u5BF9\u4E8E\u7EAF\u6587\u672C\u6765\u8BF4\u53EF\u4EE5\u538B\u7F29\u5230\u539F\u5927\u5C0F\u7684 40%\uFF0C\u53EF\u4EE5\u8282\u7701\u5927\u91CF\u7684\u5E26\u5BBD\u3002\u542F\u7528 gzip \u6240\u9700\u7684 HTTP \u6700\u4F4E\u7248\u672C\u662F 1.1\u3002</p><div class="language-nginx line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki"><code><span class="line"><span style="color:#89DDFF;">location</span><span style="color:#A6ACCD;">\xA0</span><span style="color:#89DDFF;">~</span><span style="color:#A6ACCD;">\xA0.*\\.\xA0(jpg|png|gif)$\xA0{\xA0\xA0\xA0\xA0</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> gzip\xA0</span><span style="color:#A6ACCD;">off</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;">\xA0</span><span style="color:#676E95;">#\u5173\u95ED\u538B\u7F29\xA0\xA0\xA0\xA0</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> root\xA0</span><span style="color:#A6ACCD;">xxxx</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#89DDFF;">location</span><span style="color:#A6ACCD;">\xA0</span><span style="color:#89DDFF;">~</span><span style="color:#A6ACCD;">\xA0.*\\.\xA0(html|js|css)$\xA0{\xA0\xA0\xA0\xA0</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> gzip\xA0</span><span style="color:#A6ACCD;">on</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;">\xA0</span><span style="color:#676E95;">#\u542F\u7528\u538B\u7F29\xA0\xA0\xA0\xA0</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> gzip_min_length\xA0</span><span style="color:#A6ACCD;">1k</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;">\xA0</span><span style="color:#676E95;">#\xA0\u8D85\u8FC71K\u7684\u6587\u4EF6\u624D\u538B\u7F29\xA0\xA0\xA0\xA0</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> gzip_http_version\xA0</span><span style="color:#A6ACCD;">1.1</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;">\xA0</span><span style="color:#676E95;">#\xA0\u542F\u7528gzip\u538B\u7F29\u6240\u9700\u7684HTTP\u6700\u4F4E\u7248\u672C\xA0\xA0\xA0\xA0</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> gzip_comp_level\xA0</span><span style="color:#A6ACCD;">9</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;">\xA0</span><span style="color:#676E95;">#\xA0\u538B\u7F29\u7EA7\u522B\uFF0C\u538B\u7F29\u6BD4\u7387\u8D8A\u9AD8\uFF0C\u6587\u4EF6\u88AB\u538B\u7F29\u7684\u4F53\u79EF\u8D8A\u5C0F\xA0\xA0\xA0\xA0</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> gzip_types\xA0</span><span style="color:#A6ACCD;">text/css\xA0application/javascript</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;">\xA0</span><span style="color:#676E95;">#\xA0\u8FDB\u884C\u538B\u7F29\u7684\u6587\u4EF6\u7C7B\u578B\xA0\xA0\xA0\xA0</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> root\xA0</span><span style="color:#A6ACCD;">xxxx</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h2 id="\u8BF7\u6C42\u9650\u5236" tabindex="-1">\u8BF7\u6C42\u9650\u5236 <a class="header-anchor" href="#\u8BF7\u6C42\u9650\u5236" aria-hidden="true">#</a></h2><p>\u5BF9\u4E8E\u5927\u6D41\u91CF\u6076\u610F\u7684\u8BBF\u95EE\uFF0C\u4F1A\u9020\u6210\u5E26\u5BBD\u7684\u6D6A\u8D39\uFF0C\u7ED9\u670D\u52A1\u5668\u589E\u52A0\u538B\u529B\u3002\u5F80\u5F80\u5BF9\u4E8E\u540C\u4E00 <code>IP</code> \u7684\u8FDE\u63A5\u6570\u4EE5\u53CA\u5E76\u53D1\u6570\u8FDB\u884C\u9650\u5236\u3002 \u5173\u4E8E\u8BF7\u6C42\u9650\u5236\u4E3B\u8981\u6709\u4E24\u79CD\u7C7B\u578B\uFF1A</p><ul><li>limit_conn_module \u8FDE\u63A5\u9891\u7387\u9650\u5236</li><li>limit_req_module \u8BF7\u6C42\u9891\u7387\u9650\u5236</li></ul><div class="language-nginx line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki"><code><span class="line"><span style="color:#676E95;">#\xA0$binary_remote_addr\xA0\u8FDC\u7A0BIP\u5730\u5740\xA0zone\xA0\u533A\u57DF\u540D\u79F0\xA010m\u5185\u5B58\u533A\u57DF\u5927\u5C0F</span></span>
<span class="line"><span style="color:#89DDFF;">limit_conn_zone\xA0$</span><span style="color:#A6ACCD;">binary_remote_addr\xA0zone=coon_zone:10m</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">server</span><span style="color:#A6ACCD;">\xA0{\xA0\xA0\xA0\xA0</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#676E95;">#\xA0conn_zone\xA0\u8BBE\u7F6E\u5BF9\u5E94\u7684\u5171\u4EAB\u5185\u5B58\u533A\u57DF\xA01\u662F\u9650\u5236\u7684\u6570\u91CF\xA0</span></span>
<span class="line"><span style="color:#A6ACCD;">  limit_conn\xA0conn_zone\xA01;</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><div class="language-nginx line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki"><code><span class="line"><span style="color:#676E95;">#\xA0$binary_remote_addr\xA0\u8FDC\u7A0BIP\u5730\u5740\xA0zone\xA0\u533A\u57DF\u540D\u79F0\xA010m\u5185\u5B58\u533A\u57DF\u5927\u5C0F\xA0rate\xA0\u4E3A\u8BF7\u6C42\u9891\u7387\xA01s\xA0\u4E00\u6B21limit_req_zone\xA0$binary_remote_addr\xA0zone=req_zone:10m\xA0rate=1r/s;</span></span>
<span class="line"><span style="color:#89DDFF;">server</span><span style="color:#A6ACCD;">\xA0{\xA0\xA0\xA0\xA0</span></span>
<span class="line"><span style="color:#A6ACCD;">  location\xA0/\xA0{\xA0\xA0\xA0\xA0\xA0\xA0\xA0\xA0</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;">#\xA0\u8BBE\u7F6E\u5BF9\u5E94\u7684\u5171\u4EAB\u5185\u5B58\u533A\u57DF\xA0burst\u6700\u5927\u8BF7\u6C42\u6570\u9608\u503C\xA0nodelay\u4E0D\u5E0C\u671B\u8D85\u8FC7\u7684\u8BF7\u6C42\u88AB\u5EF6\u8FDF\xA0\xA0\xA0\xA0\xA0\xA0\xA0\xA0</span></span>
<span class="line"><span style="color:#A6ACCD;">    limit_req\xA0zone=req_zone\xA0burst=5\xA0nodelay;\xA0\xA0\xA0</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h2 id="\u8BBF\u95EE\u63A7\u5236" tabindex="-1">\u8BBF\u95EE\u63A7\u5236 <a class="header-anchor" href="#\u8BBF\u95EE\u63A7\u5236" aria-hidden="true">#</a></h2><div class="language-nginx line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki"><code><span class="line"><span style="color:#A6ACCD;">// \u57FA\u4E8E </span><span style="color:#89DDFF;">IP</span><span style="color:#A6ACCD;"> \u7684\u8BBF\u95EE\u63A7\u5236</span></span>
<span class="line"><span style="color:#89DDFF;">server</span><span style="color:#A6ACCD;">\xA0{</span></span>
<span class="line"><span style="color:#A6ACCD;">  location\xA0</span><span style="color:#89DDFF;">~</span><span style="color:#A6ACCD;">\xA0^/index.html\xA0{\xA0</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;">#\xA0\u5339\u914D\xA0index.html\xA0\u9875\u9762\xA0\u9664\u4E86\xA0127.0.0.1\xA0\u4EE5\u5916\u90FD\u53EF\u4EE5\u8BBF\u95EE\xA0\xA0</span></span>
<span class="line"><span style="color:#A6ACCD;">    deny\xA0127.0.0.1;\xA0\xA0</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> allow\xA0</span><span style="color:#A6ACCD;">all</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;">\xA0</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h2 id="\u9632\u76D7\u94FE" tabindex="-1">\u9632\u76D7\u94FE <a class="header-anchor" href="#\u9632\u76D7\u94FE" aria-hidden="true">#</a></h2><p>\u9632\u76D7\u94FE\u7684\u539F\u7406\u5C31\u662F\u6839\u636E\u8BF7\u6C42\u5934\u4E2D referer \u5F97\u5230\u7F51\u9875\u6765\u6E90\uFF0C\u4ECE\u800C\u5B9E\u73B0\u8BBF\u95EE\u63A7\u5236\u3002\u8FD9\u6837\u53EF\u4EE5\u9632\u6B62\u7F51\u7AD9\u8D44\u6E90\u88AB\u975E\u6CD5\u76D7\u7528\uFF0C\u4ECE\u800C\u4FDD\u8BC1\u4FE1\u606F\u5B89\u5168\uFF0C\u51CF\u5C11\u5E26\u5BBD\u635F\u8017\uFF0C\u51CF\u8F7B\u670D\u52A1\u5668\u538B\u529B\u3002</p><div class="language-nginx line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki"><code><span class="line"><span style="color:#89DDFF;">location</span><span style="color:#A6ACCD;">\xA0</span><span style="color:#89DDFF;">~</span><span style="color:#A6ACCD;">\xA0.*\\.(jpg|png|gif)$\xA0{\xA0</span><span style="color:#676E95;">#\xA0\u5339\u914D\u9632\u76D7\u94FE\u8D44\u6E90\u7684\u6587\u4EF6\u7C7B\u578B\xA0\xA0\xA0\xA0</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#676E95;">#\xA0\u901A\u8FC7\xA0valid_referers\xA0\u5B9A\u4E49\u5408\u6CD5\u7684\u5730\u5740\u767D\u540D\u5355\xA0$invalid_referer\xA0\u4E0D\u5408\u6CD5\u7684\u8FD4\u56DE403\xA0\xA0\xA0\xA0\xA0\xA0</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> valid_referers\xA0</span><span style="color:#A6ACCD;">none\xA0blocked\xA0127.0.0.1</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;">\xA0\xA0\xA0\xA0</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">if</span><span style="color:#A6ACCD;">\xA0(</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">invalid_referer)\xA0{\xA0\xA0\xA0\xA0\xA0\xA0\xA0\xA0</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">return</span><span style="color:#A6ACCD;">\xA0403;\xA0\xA0\xA0\xA0</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h2 id="\u8D1F\u8F7D\u5747\u8861-load-balance" tabindex="-1">\u8D1F\u8F7D\u5747\u8861 Load Balance <a class="header-anchor" href="#\u8D1F\u8F7D\u5747\u8861-load-balance" aria-hidden="true">#</a></h2><p>\u5F53\u6211\u4EEC\u7684\u7F51\u7AD9\u9700\u8981\u89E3\u51B3\u9AD8\u5E76\u53D1\u3001\u6D77\u91CF\u6570\u636E\u95EE\u9898\u65F6\uFF0C\u5C31\u9700\u8981\u4F7F\u7528\u8D1F\u8F7D\u5747\u8861\u6765\u8C03\u5EA6\u670D\u52A1\u5668\u3002\u5C06\u8BF7\u6C42\u5408\u7406\u7684\u5206\u53D1\u5230\u5E94\u7528\u670D\u52A1\u5668\u96C6\u7FA4\u4E2D\u7684\u4E00\u53F0\u53F0\u670D\u52A1\u5668\u4E0A\u3002</p><div class="language-nginx line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki"><code><span class="line"><span style="color:#676E95;">#\xA0upstream\xA0\u6307\u5B9A\u540E\u7AEF\u670D\u52A1\u5668\u5730\u5740</span></span>
<span class="line"><span style="color:#676E95;">#\xA0weight\xA0\u8BBE\u7F6E\u6743\u91CD</span></span>
<span class="line"><span style="color:#676E95;">#\xA0server\xA0\u4E2D\u4F1A\u5C06\xA0http://webcanteen\xA0\u7684\u8BF7\u6C42\u8F6C\u53D1\u5230\xA0upstream\xA0\u6C60\u4E2D</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">upstream</span><span style="color:#A6ACCD;">\xA0webcanteen\xA0{\xA0\xA0\xA0\xA0</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">server</span><span style="color:#A6ACCD;">\xA0127.0.0.1:66\xA0</span><span style="color:#A6ACCD;">weight</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">10</span><span style="color:#A6ACCD;">;\xA0\xA0\xA0\xA0</span></span>
<span class="line"><span style="color:#A6ACCD;">  server\xA0127.0.0.1:77\xA0</span><span style="color:#A6ACCD;">weight</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">;\xA0\xA0\xA0\xA0</span></span>
<span class="line"><span style="color:#A6ACCD;">  server\xA0127.0.0.1:88\xA0</span><span style="color:#A6ACCD;">weight</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">;}</span></span>
<span class="line"><span style="color:#A6ACCD;">server\xA0{\xA0\xA0\xA0\xA0</span></span>
<span class="line"><span style="color:#A6ACCD;">  location\xA0/\xA0{\xA0\xA0\xA0\xA0\xA0\xA0\xA0\xA0</span></span>
<span class="line"><span style="color:#A6ACCD;">    proxy_pass\xA0http://webcanteen\xA0\xA0\xA0\xA0</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h3 id="\u540E\u7AEF\u670D\u52A1\u5668\u72B6\u6001" tabindex="-1">\u540E\u7AEF\u670D\u52A1\u5668\u72B6\u6001 <a class="header-anchor" href="#\u540E\u7AEF\u670D\u52A1\u5668\u72B6\u6001" aria-hidden="true">#</a></h3><p>down\uFF1A\u5F53\u524D\u670D\u52A1\u5668\u4E0D\u53C2\u4E0E\u8D1F\u8F7D\u5747\u8861 backup\uFF1A\u5F53\u5176\u4ED6\u8282\u70B9\u90FD\u65E0\u6CD5\u4F7F\u7528\u65F6\u7684\u5907\u7528\u670D\u52A1\u5668 max_fails\uFF1A\u5141\u8BB8\u8BF7\u6C42\u5931\u8D25\u7684\u6B21\u6570\uFF0C\u82E5\u5230\u8FBE\u5C31\u4F1A\u4F11\u7720 fail_timeout\uFF1A\u7ECF\u8FC7 max_fails \u6B21\u5931\u8D25\u540E\uFF0C\u670D\u52A1\u5668\u7684\u6682\u505C\u65F6\u95F4\uFF0C\u9ED8\u8BA4\u4E3A 10s max_conns\uFF1A\u9650\u5236\u6BCF\u4E2A\u670D\u52A1\u5668\u7684\u6700\u5927\u63A5\u6536\u8FDE\u63A5\u6570</p><div class="language-nginx line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki"><code><span class="line"><span style="color:#89DDFF;">upstream</span><span style="color:#A6ACCD;">\xA0webcanteen\xA0{\xA0</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">server</span><span style="color:#A6ACCD;">\xA0127.0.0.1:66\xA0down;\xA0</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">server</span><span style="color:#A6ACCD;">\xA0127.0.0.1:77\xA0backup;\xA0</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">server</span><span style="color:#A6ACCD;">\xA0127.0.0.1:88\xA0\xA0</span><span style="color:#A6ACCD;">max_fails</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">3</span><span style="color:#A6ACCD;">\xA0fail_timeout=10s;\xA0</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">server</span><span style="color:#A6ACCD;">\xA0127.0.0.1:99\xA0max_conns=1000;</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="\u5206\u914D\u65B9\u5F0F" tabindex="-1">\u5206\u914D\u65B9\u5F0F <a class="header-anchor" href="#\u5206\u914D\u65B9\u5F0F" aria-hidden="true">#</a></h3><p>\u8F6E\u8BE2\uFF08\u9ED8\u8BA4\uFF09\uFF0C\u6BCF\u4E2A\u8BF7\u6C42\u6309\u7167\u65F6\u95F4\u987A\u5E8F\u8F6E\u6D41\u5206\u914D\u5230\u4E0D\u540C\u7684\u540E\u7AEF\u670D\u52A1\u5668\uFF0C\u5982\u679C\u67D0\u53F0\u540E\u7AEF\u670D\u52A1\u5668\u5B95\u673A\uFF0CNginx \u8F6E\u8BAD\u5217\u8868\u4F1A\u81EA\u52A8\u5C06\u5B83\u53BB\u9664\u6389\uFF1B weight\uFF08\u52A0\u6743\u8F6E\u8BE2\uFF09\uFF0C\u8F6E\u8BE2\u7684\u52A0\u5F3A\u7248\uFF0Cweight \u548C\u8BBF\u95EE\u51E0\u7387\u6210\u6B63\u6BD4\uFF0C\u4E3B\u8981\u7528\u4E8E\u540E\u7AEF\u670D\u52A1\u5668\u6027\u80FD\u4E0D\u5747\u7684\u573A\u666F\uFF1B ip_hash\uFF0C\u6BCF\u4E2A\u8BF7\u6C42\u6309\u7167\u8BBF\u95EE IP \u7684 hash \u7ED3\u679C\u5206\u914D\uFF0C\u8FD9\u6837\u6BCF\u4E2A\u8BBF\u95EE\u53EF\u4EE5\u56FA\u5B9A\u8BBF\u95EE\u4E00\u4E2A\u540E\u7AEF\u670D\u52A1\u5668\uFF1B url_hash\uFF0C\u6309\u7167\u8BBF\u95EE URL \u7684 hash \u7ED3\u679C\u6765\u5206\u914D\u8BF7\u6C42\uFF0C\u4F7F\u5F97\u6BCF\u4E2A URL \u5B9A\u5411\u5230\u540C\u4E00\u4E2A\u540E\u7AEF\u670D\u52A1\u5668\u4E0A\uFF0C\u4E3B\u8981\u5E94\u7528\u4E8E\u540E\u7AEF\u670D\u52A1\u5668\u4E3A\u7F13\u5B58\u65F6\u7684\u573A\u666F\uFF1B \u81EA\u5B9A\u4E49 hash\uFF0C\u57FA\u4E8E\u4EFB\u610F\u5173\u952E\u5B57\u4F5C\u4E3A hash key \u5B9E\u73B0 hash \u7B97\u6CD5\u7684\u8D1F\u8F7D\u5747\u8861\uFF1B fair\uFF0C\u6309\u7167\u540E\u7AEF\u670D\u52A1\u5668\u7684\u54CD\u5E94\u65F6\u95F4\u6765\u5206\u914D\u8BF7\u6C42\uFF0C\u54CD\u5E94\u65F6\u95F4\u77ED\u5219\u4F18\u5148\u5206\u914D\u3002</p>`,55),o=[e];function r(c,t,i,C,y,D){return n(),a("div",null,o)}const F=s(p,[["render",r]]);export{b as __pageData,F as default};
