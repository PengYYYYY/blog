import{_ as s,c as n,o as a,U as l}from"./chunks/framework.-vLQ8d8w.js";const p="/blog/assets/7tMW11.suetghjd.png",o="/blog/assets/wph1Jq.o6QbrGnz.png",A=JSON.parse('{"title":"样式包","description":"","frontmatter":{},"headers":[],"relativePath":"work/tc-travel/siskin/style.md","filePath":"work/tc-travel/siskin/style.md","lastUpdated":1706116744000}'),e={name:"work/tc-travel/siskin/style.md"},c=l(`<h1 id="样式包" tabindex="-1">样式包 <a class="header-anchor" href="#样式包" aria-label="Permalink to &quot;样式包&quot;">​</a></h1><p>在做组件库的时候，需要满足使用方的5个渠道 <code>wechat app elong qq touch</code>5个渠道主题样式,一套混合样式(用于使用class类名来加载不同样式的应用)，一套全尺寸样式(基于750px)的应用，一套vw样式（以375px基准）。简单说一些整个流程:</p><h2 id="文件目录如下" tabindex="-1">文件目录如下 <a class="header-anchor" href="#文件目录如下" aria-label="Permalink to &quot;文件目录如下&quot;">​</a></h2><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#FFCB6B;">├──</span><span style="color:#C3E88D;"> app</span></span>
<span class="line"><span style="color:#FFCB6B;">│</span><span style="color:#C3E88D;">   └──</span><span style="color:#C3E88D;"> variables.less</span></span>
<span class="line"><span style="color:#FFCB6B;">├──</span><span style="color:#C3E88D;"> qq</span></span>
<span class="line"><span style="color:#FFCB6B;">│</span><span style="color:#C3E88D;">   └──</span><span style="color:#C3E88D;"> variables.less</span></span>
<span class="line"><span style="color:#FFCB6B;">├──</span><span style="color:#C3E88D;"> wechat</span></span>
<span class="line"><span style="color:#FFCB6B;">│</span><span style="color:#C3E88D;">   └──</span><span style="color:#C3E88D;"> variables.less</span></span>
<span class="line"><span style="color:#FFCB6B;">├──</span><span style="color:#C3E88D;"> default</span></span>
<span class="line"><span style="color:#FFCB6B;">│</span><span style="color:#C3E88D;">   ├──</span><span style="color:#C3E88D;"> action-sheet.less</span></span>
<span class="line"><span style="color:#FFCB6B;">│</span><span style="color:#C3E88D;">   ├──</span><span style="color:#C3E88D;"> anchor.less</span></span>
<span class="line"><span style="color:#FFCB6B;">│</span><span style="color:#C3E88D;">   ├──</span><span style="color:#C3E88D;"> base.less</span></span>
<span class="line"><span style="color:#FFCB6B;">│</span><span style="color:#C3E88D;">   ├──</span><span style="color:#C3E88D;"> button.less</span></span>
<span class="line"><span style="color:#FFCB6B;">│</span><span style="color:#C3E88D;">   ├──</span><span style="color:#C3E88D;"> calendar.less</span></span>
<span class="line"><span style="color:#FFCB6B;">│</span><span style="color:#C3E88D;">   ├──</span><span style="color:#C3E88D;"> card.less</span></span>
<span class="line"><span style="color:#FFCB6B;">│</span><span style="color:#C3E88D;">   ├──</span><span style="color:#C3E88D;"> checkbox.less</span></span>
<span class="line"><span style="color:#FFCB6B;">│</span><span style="color:#C3E88D;">   ├──</span><span style="color:#C3E88D;"> city-picker.less</span></span>
<span class="line"><span style="color:#FFCB6B;">│</span><span style="color:#C3E88D;">   ├──</span><span style="color:#C3E88D;"> date-picker.less</span></span>
<span class="line"><span style="color:#FFCB6B;">│</span><span style="color:#C3E88D;">   ├──</span><span style="color:#C3E88D;"> dialog.less</span></span>
<span class="line"><span style="color:#FFCB6B;">│</span><span style="color:#C3E88D;">   ├──</span><span style="color:#C3E88D;"> fonts</span></span>
<span class="line"><span style="color:#FFCB6B;">│</span><span style="color:#C3E88D;">   │</span><span style="color:#C3E88D;">   ├──</span><span style="color:#C3E88D;"> iconfont.ttf</span></span>
<span class="line"><span style="color:#FFCB6B;">│</span><span style="color:#C3E88D;">   │</span><span style="color:#C3E88D;">   └──</span><span style="color:#C3E88D;"> iconfont.woff</span></span>
<span class="line"><span style="color:#FFCB6B;">│</span><span style="color:#C3E88D;">   ├──</span><span style="color:#C3E88D;"> icon.less</span></span>
<span class="line"><span style="color:#FFCB6B;">│</span><span style="color:#C3E88D;">   ├──</span><span style="color:#C3E88D;"> image-upload.less</span></span>
<span class="line"><span style="color:#FFCB6B;">│</span><span style="color:#C3E88D;">   ├──</span><span style="color:#C3E88D;"> index.less</span></span>
<span class="line"><span style="color:#FFCB6B;">│</span><span style="color:#C3E88D;">   ├──</span><span style="color:#C3E88D;"> input-number.less</span></span>
<span class="line"><span style="color:#FFCB6B;">│</span><span style="color:#C3E88D;">   ├──</span><span style="color:#C3E88D;"> label.less</span></span>
<span class="line"><span style="color:#FFCB6B;">│</span><span style="color:#C3E88D;">   ├──</span><span style="color:#C3E88D;"> name-to-spell.less</span></span>
<span class="line"><span style="color:#FFCB6B;">│</span><span style="color:#C3E88D;">   ├──</span><span style="color:#C3E88D;"> notice.less</span></span>
<span class="line"><span style="color:#FFCB6B;">│</span><span style="color:#C3E88D;">   ├──</span><span style="color:#C3E88D;"> picker.less</span></span>
<span class="line"><span style="color:#FFCB6B;">│</span><span style="color:#C3E88D;">   ├──</span><span style="color:#C3E88D;"> popup.less</span></span>
<span class="line"><span style="color:#FFCB6B;">│</span><span style="color:#C3E88D;">   ├──</span><span style="color:#C3E88D;"> radio.less</span></span>
<span class="line"><span style="color:#FFCB6B;">│</span><span style="color:#C3E88D;">   ├──</span><span style="color:#C3E88D;"> skeleton.less</span></span>
<span class="line"><span style="color:#FFCB6B;">│</span><span style="color:#C3E88D;">   ├──</span><span style="color:#C3E88D;"> slide.less</span></span>
<span class="line"><span style="color:#FFCB6B;">│</span><span style="color:#C3E88D;">   ├──</span><span style="color:#C3E88D;"> slider.less</span></span>
<span class="line"><span style="color:#FFCB6B;">│</span><span style="color:#C3E88D;">   ├──</span><span style="color:#C3E88D;"> swiper.less</span></span>
<span class="line"><span style="color:#FFCB6B;">│</span><span style="color:#C3E88D;">   ├──</span><span style="color:#C3E88D;"> switch.less</span></span>
<span class="line"><span style="color:#FFCB6B;">│</span><span style="color:#C3E88D;">   ├──</span><span style="color:#C3E88D;"> tab-bar.less</span></span>
<span class="line"><span style="color:#FFCB6B;">│</span><span style="color:#C3E88D;">   ├──</span><span style="color:#C3E88D;"> table.less</span></span>
<span class="line"><span style="color:#FFCB6B;">│</span><span style="color:#C3E88D;">   ├──</span><span style="color:#C3E88D;"> time-line.less</span></span>
<span class="line"><span style="color:#FFCB6B;">│</span><span style="color:#C3E88D;">   ├──</span><span style="color:#C3E88D;"> tip.less</span></span>
<span class="line"><span style="color:#FFCB6B;">│</span><span style="color:#C3E88D;">   ├──</span><span style="color:#C3E88D;"> toast.less</span></span>
<span class="line"><span style="color:#FFCB6B;">│</span><span style="color:#C3E88D;">   ├──</span><span style="color:#C3E88D;"> transition.less</span></span>
<span class="line"><span style="color:#FFCB6B;">│</span><span style="color:#C3E88D;">   └──</span><span style="color:#C3E88D;"> variables.less</span></span>
<span class="line"><span style="color:#FFCB6B;">├──</span><span style="color:#C3E88D;"> gulpfile.js</span></span>
<span class="line"><span style="color:#FFCB6B;">├──</span><span style="color:#C3E88D;"> less-extract.js</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br></div></div><p>每个渠道的variables.less的中存放各渠道的环境变量，default存放基础样式信息。</p><p>最终得到的产物</p><p><img src="`+p+`" alt="img"></p><p>首先分各渠道，<code>fullsize</code>和<code>vwsize</code>分别对应二倍屏和<code>vw</code>单位的样式包，<code>hybrid</code>包用于使用方使用<code>class</code>来区分渠道的包。</p><h3 id="打包流程" tabindex="-1">打包流程 <a class="header-anchor" href="#打包流程" aria-label="Permalink to &quot;打包流程&quot;">​</a></h3><ul><li>生成extract目录（只包含变量名的less文件）用于生产混合包，优化代码体积</li><li>从default(样式为wechat)文件中复制各组件样式文件到各渠道目录下</li><li>复制相同样式的渠道</li><li>编译各渠道基础样式</li><li>编译各渠道extract目录到factory目录，生成带类名的样式文件</li><li>连接各渠道的基础样式与带类名的样式文件，生成混合包</li><li>生成全尺寸样式包,生成vw样式包,开发环境时执行空任务</li><li>复制字体文件到各个渠道</li><li>复制到lib生产目录</li><li>删除生成的文件，打包结束</li></ul><h3 id="code" tabindex="-1">code <a class="header-anchor" href="#code" aria-label="Permalink to &quot;code&quot;">​</a></h3><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#676E95;font-style:italic;">// gulpfile</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#89DDFF;"> {</span><span style="color:#BABED8;"> series</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> src</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> dest</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> task</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> parallel </span><span style="color:#89DDFF;">}</span><span style="color:#89DDFF;"> =</span><span style="color:#82AAFF;"> require</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">gulp</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> less </span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;"> require</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">gulp-less</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> autoprefixer </span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;"> require</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">gulp-autoprefixer</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> cssmin </span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;"> require</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">gulp-cssmin</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#C792EA;">var</span><span style="color:#BABED8;"> cssWrap </span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;"> require</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">@wwh/gulp-css-wrap</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#C792EA;">var</span><span style="color:#BABED8;"> merge </span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;"> require</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">merge-stream</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> concat </span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;"> require</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">gulp-concat</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> replace </span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;"> require</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">gulp-replace</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> rimraf </span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;"> require</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">rimraf</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> generateExtract </span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;"> require</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./less-extract</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> components </span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;"> require</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">../build/components.json</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#BABED8;">components</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">push</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">index</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// 基础渠道样式</span></span>
<span class="line"><span style="color:#C792EA;">let</span><span style="color:#BABED8;"> channelList </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> [</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">app</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;"> &#39;</span><span style="color:#C3E88D;">wechat</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;"> &#39;</span><span style="color:#C3E88D;">qq</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// 生成extract目录（只包含变量名的less文件）用于生产混合包，优化代码体积</span></span>
<span class="line"><span style="color:#C792EA;">async</span><span style="color:#C792EA;"> function</span><span style="color:#82AAFF;"> createExtract</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">done</span><span style="color:#89DDFF;">)</span><span style="color:#89DDFF;"> {</span></span>
<span class="line"><span style="color:#BABED8;">  channelList</span><span style="color:#89DDFF;"> =</span><span style="color:#F07178;"> [</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">app</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;"> &#39;</span><span style="color:#C3E88D;">wechat</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;"> &#39;</span><span style="color:#C3E88D;">qq</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">]</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">  await</span><span style="color:#82AAFF;"> generateExtract</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">components</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#82AAFF;">  done</span><span style="color:#F07178;">()</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// 复制相同样式的渠道</span></span>
<span class="line"><span style="color:#C792EA;">function</span><span style="color:#82AAFF;"> copySameChannel</span><span style="color:#89DDFF;">()</span><span style="color:#89DDFF;"> {</span></span>
<span class="line"><span style="color:#C792EA;">  const</span><span style="color:#BABED8;"> taskList</span><span style="color:#89DDFF;"> =</span><span style="color:#F07178;"> []</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">  // 复制app到touch组件目录加入touch站</span></span>
<span class="line"><span style="color:#BABED8;">  taskList</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">push</span><span style="color:#F07178;">(</span><span style="color:#82AAFF;">src</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./app/**</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">pipe</span><span style="color:#F07178;">(</span><span style="color:#82AAFF;">dest</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">./touch/</span><span style="color:#89DDFF;">\`</span><span style="color:#F07178;">)))</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">  // 复制qq到elong组件目录加入elong站</span></span>
<span class="line"><span style="color:#BABED8;">  taskList</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">push</span><span style="color:#F07178;">(</span><span style="color:#82AAFF;">src</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./qq/**</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">pipe</span><span style="color:#F07178;">(</span><span style="color:#82AAFF;">dest</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">./elong/</span><span style="color:#89DDFF;">\`</span><span style="color:#F07178;">)))</span></span>
<span class="line"><span style="color:#BABED8;">  channelList</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">push</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">touch</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;"> &#39;</span><span style="color:#C3E88D;">elong</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">  return</span><span style="color:#82AAFF;"> merge</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">...</span><span style="color:#BABED8;">taskList</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#676E95;font-style:italic;">// 编译各渠道基础样式</span></span>
<span class="line"><span style="color:#C792EA;">function</span><span style="color:#82AAFF;"> compileBase</span><span style="color:#89DDFF;">()</span><span style="color:#89DDFF;"> {</span></span>
<span class="line"><span style="color:#C792EA;">  const</span><span style="color:#BABED8;"> taskList</span><span style="color:#89DDFF;"> =</span><span style="color:#F07178;"> []</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">  for</span><span style="color:#F07178;"> (</span><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> channel</span><span style="color:#89DDFF;"> of</span><span style="color:#BABED8;"> channelList</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#C792EA;">    const</span><span style="color:#BABED8;"> channelCompile</span><span style="color:#89DDFF;"> =</span><span style="color:#82AAFF;"> src</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">./</span><span style="color:#89DDFF;">\${</span><span style="color:#BABED8;">channel</span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;">/*.less</span><span style="color:#89DDFF;">\`</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">pipe</span><span style="color:#F07178;">(</span><span style="color:#82AAFF;">less</span><span style="color:#F07178;">())</span></span>
<span class="line"><span style="color:#89DDFF;">      .</span><span style="color:#82AAFF;">pipe</span><span style="color:#F07178;">(</span><span style="color:#82AAFF;">autoprefixer</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        overrideBrowserslist</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> [</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">ie &gt; 9</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;"> &#39;</span><span style="color:#C3E88D;">last 2 versions</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">        cascade</span><span style="color:#89DDFF;">:</span><span style="color:#FF9CAC;"> false</span></span>
<span class="line"><span style="color:#89DDFF;">      }</span><span style="color:#F07178;">))</span></span>
<span class="line"><span style="color:#89DDFF;">      .</span><span style="color:#82AAFF;">pipe</span><span style="color:#F07178;">(</span><span style="color:#82AAFF;">cssmin</span><span style="color:#F07178;">())</span></span>
<span class="line"><span style="color:#89DDFF;">      .</span><span style="color:#82AAFF;">pipe</span><span style="color:#F07178;">(</span><span style="color:#82AAFF;">dest</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">./</span><span style="color:#89DDFF;">\${</span><span style="color:#BABED8;">channel</span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;">/lib</span><span style="color:#89DDFF;">\`</span><span style="color:#F07178;">))</span></span>
<span class="line"><span style="color:#BABED8;">    taskList</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">push</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">channelCompile</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">  }</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">  return</span><span style="color:#82AAFF;"> merge</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">...</span><span style="color:#BABED8;">taskList</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// 合成全尺寸包</span></span>
<span class="line"><span style="color:#C792EA;">function</span><span style="color:#82AAFF;"> copyFullSize</span><span style="color:#89DDFF;">()</span><span style="color:#89DDFF;"> {</span></span>
<span class="line"><span style="color:#C792EA;">  const</span><span style="color:#BABED8;"> taskList</span><span style="color:#89DDFF;"> =</span><span style="color:#F07178;"> []</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">  for</span><span style="color:#F07178;"> (</span><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> channel</span><span style="color:#89DDFF;"> of</span><span style="color:#BABED8;"> channelList</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#C792EA;">    let</span><span style="color:#BABED8;"> copyPath</span><span style="color:#89DDFF;"> =</span><span style="color:#89DDFF;"> \`</span><span style="color:#C3E88D;">./</span><span style="color:#89DDFF;">\${</span><span style="color:#BABED8;">channel</span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;">/lib/*.css</span><span style="color:#89DDFF;">\`</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">    if</span><span style="color:#F07178;"> (</span><span style="color:#BABED8;">channel</span><span style="color:#89DDFF;"> ==</span><span style="color:#89DDFF;"> &#39;</span><span style="color:#C3E88D;">hybrid</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">      copyPath</span><span style="color:#89DDFF;"> =</span><span style="color:#89DDFF;"> \`</span><span style="color:#C3E88D;">./hybrid/*.css</span><span style="color:#89DDFF;">\`</span></span>
<span class="line"><span style="color:#89DDFF;">    }</span></span>
<span class="line"><span style="color:#C792EA;">    const</span><span style="color:#BABED8;"> channelCompile</span><span style="color:#89DDFF;"> =</span><span style="color:#82AAFF;"> src</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">copyPath</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">      .</span><span style="color:#82AAFF;">pipe</span><span style="color:#F07178;">(</span><span style="color:#82AAFF;">replace</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">/([</span><span style="color:#C3E88D;">0-9</span><span style="color:#89DDFF;">]+(</span><span style="color:#BABED8;">\\.</span><span style="color:#89DDFF;">?[</span><span style="color:#C3E88D;">0-9</span><span style="color:#89DDFF;">]+)?)</span><span style="color:#C3E88D;">px</span><span style="color:#89DDFF;">/</span><span style="color:#F78C6C;">g</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;"> (</span><span style="color:#BABED8;font-style:italic;">match</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;font-style:italic;"> p1</span><span style="color:#89DDFF;">)</span><span style="color:#C792EA;"> =&gt;</span><span style="color:#89DDFF;"> {</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">        return</span><span style="color:#82AAFF;"> Number</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">p1</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">*</span><span style="color:#F78C6C;"> 2</span><span style="color:#89DDFF;"> +</span><span style="color:#89DDFF;"> &#39;</span><span style="color:#C3E88D;">px</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;">      }</span><span style="color:#F07178;">))</span></span>
<span class="line"><span style="color:#89DDFF;">      .</span><span style="color:#82AAFF;">pipe</span><span style="color:#F07178;">(</span><span style="color:#82AAFF;">dest</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">./fullsize/</span><span style="color:#89DDFF;">\${</span><span style="color:#BABED8;">channel</span><span style="color:#89DDFF;">}\`</span><span style="color:#F07178;">))</span></span>
<span class="line"><span style="color:#BABED8;">    taskList</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">push</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">channelCompile</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">  }</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">  return</span><span style="color:#82AAFF;"> merge</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">...</span><span style="color:#BABED8;">taskList</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// 合成vw单位包</span></span>
<span class="line"><span style="color:#C792EA;">function</span><span style="color:#82AAFF;"> copyVWSize</span><span style="color:#89DDFF;">()</span><span style="color:#89DDFF;"> {</span></span>
<span class="line"><span style="color:#C792EA;">  const</span><span style="color:#BABED8;"> taskList</span><span style="color:#89DDFF;"> =</span><span style="color:#F07178;"> []</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">  for</span><span style="color:#F07178;"> (</span><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> channel</span><span style="color:#89DDFF;"> of</span><span style="color:#BABED8;"> channelList</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#C792EA;">    let</span><span style="color:#BABED8;"> copyPath</span><span style="color:#89DDFF;"> =</span><span style="color:#89DDFF;"> \`</span><span style="color:#C3E88D;">./</span><span style="color:#89DDFF;">\${</span><span style="color:#BABED8;">channel</span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;">/lib/*.css</span><span style="color:#89DDFF;">\`</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">    if</span><span style="color:#F07178;"> (</span><span style="color:#BABED8;">channel</span><span style="color:#89DDFF;"> ==</span><span style="color:#89DDFF;"> &#39;</span><span style="color:#C3E88D;">hybrid</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">      copyPath</span><span style="color:#89DDFF;"> =</span><span style="color:#89DDFF;"> \`</span><span style="color:#C3E88D;">./hybrid/*.css</span><span style="color:#89DDFF;">\`</span></span>
<span class="line"><span style="color:#89DDFF;">    }</span></span>
<span class="line"><span style="color:#C792EA;">    const</span><span style="color:#BABED8;"> channelCompile</span><span style="color:#89DDFF;"> =</span><span style="color:#82AAFF;"> src</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">copyPath</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">      .</span><span style="color:#82AAFF;">pipe</span><span style="color:#F07178;">(</span><span style="color:#82AAFF;">replace</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">/([</span><span style="color:#C3E88D;">0-9</span><span style="color:#89DDFF;">]+(</span><span style="color:#BABED8;">\\.</span><span style="color:#89DDFF;">?[</span><span style="color:#C3E88D;">0-9</span><span style="color:#89DDFF;">]+)?)</span><span style="color:#C3E88D;">px</span><span style="color:#89DDFF;">/</span><span style="color:#F78C6C;">g</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;"> (</span><span style="color:#BABED8;font-style:italic;">match</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;font-style:italic;"> p1</span><span style="color:#89DDFF;">)</span><span style="color:#C792EA;"> =&gt;</span><span style="color:#89DDFF;"> {</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">          return</span><span style="color:#82AAFF;"> Number</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">p1</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">/</span><span style="color:#F78C6C;"> 3.75</span><span style="color:#89DDFF;"> +</span><span style="color:#89DDFF;"> &#39;</span><span style="color:#C3E88D;">vw</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;">      }</span><span style="color:#F07178;">))</span></span>
<span class="line"><span style="color:#89DDFF;">      .</span><span style="color:#82AAFF;">pipe</span><span style="color:#F07178;">(</span><span style="color:#82AAFF;">dest</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">./vwsize/</span><span style="color:#89DDFF;">\${</span><span style="color:#BABED8;">channel</span><span style="color:#89DDFF;">}\`</span><span style="color:#F07178;">))</span></span>
<span class="line"><span style="color:#BABED8;">    taskList</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">push</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">channelCompile</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">  }</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">  return</span><span style="color:#82AAFF;"> merge</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">...</span><span style="color:#BABED8;">taskList</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// 复制字体文件</span></span>
<span class="line"><span style="color:#C792EA;">function</span><span style="color:#82AAFF;"> copyFont</span><span style="color:#89DDFF;">()</span><span style="color:#89DDFF;"> {</span></span>
<span class="line"><span style="color:#C792EA;">  const</span><span style="color:#BABED8;"> taskList</span><span style="color:#89DDFF;"> =</span><span style="color:#F07178;"> []</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">  for</span><span style="color:#F07178;"> (</span><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> channel</span><span style="color:#89DDFF;"> of</span><span style="color:#BABED8;"> channelList</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#C792EA;">    const</span><span style="color:#BABED8;"> channelCopy</span><span style="color:#89DDFF;"> =</span><span style="color:#82AAFF;"> src</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./default/fonts/**</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">      .</span><span style="color:#82AAFF;">pipe</span><span style="color:#F07178;">(</span><span style="color:#82AAFF;">dest</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">./fullsize/</span><span style="color:#89DDFF;">\${</span><span style="color:#BABED8;">channel</span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;">/fonts</span><span style="color:#89DDFF;">\`</span><span style="color:#F07178;">))</span></span>
<span class="line"><span style="color:#89DDFF;">      .</span><span style="color:#82AAFF;">pipe</span><span style="color:#F07178;">(</span><span style="color:#82AAFF;">dest</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">./vwsize/</span><span style="color:#89DDFF;">\${</span><span style="color:#BABED8;">channel</span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;">/fonts</span><span style="color:#89DDFF;">\`</span><span style="color:#F07178;">))</span></span>
<span class="line"><span style="color:#89DDFF;">      .</span><span style="color:#82AAFF;">pipe</span><span style="color:#F07178;">(</span><span style="color:#82AAFF;">dest</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">channel</span><span style="color:#89DDFF;"> ===</span><span style="color:#89DDFF;"> &#39;</span><span style="color:#C3E88D;">hybrid</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;"> ?</span><span style="color:#89DDFF;"> \`</span><span style="color:#C3E88D;">./</span><span style="color:#89DDFF;">\${</span><span style="color:#BABED8;">channel</span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;">/fonts</span><span style="color:#89DDFF;">\`</span><span style="color:#89DDFF;"> :</span><span style="color:#89DDFF;"> \`</span><span style="color:#C3E88D;">./</span><span style="color:#89DDFF;">\${</span><span style="color:#BABED8;">channel</span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;">/lib/fonts</span><span style="color:#89DDFF;">\`</span><span style="color:#F07178;">))</span></span>
<span class="line"><span style="color:#BABED8;">    taskList</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">push</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">channelCopy</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">  }</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">  return</span><span style="color:#82AAFF;"> merge</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">...</span><span style="color:#BABED8;">taskList</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br></div></div><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#676E95;font-style:italic;">// 复制到生产目录</span></span>
<span class="line"><span style="color:#C792EA;">function</span><span style="color:#82AAFF;"> copyToLib</span><span style="color:#89DDFF;">()</span><span style="color:#89DDFF;"> {</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">  // 加入vwsize,fullsize样式包</span></span>
<span class="line"><span style="color:#BABED8;">  channelList</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">push</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">vwsize</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;"> &#39;</span><span style="color:#C3E88D;">fullsize</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#C792EA;">  const</span><span style="color:#BABED8;"> taskList</span><span style="color:#89DDFF;"> =</span><span style="color:#F07178;"> []</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">  for</span><span style="color:#F07178;"> (</span><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> channel</span><span style="color:#89DDFF;"> of</span><span style="color:#BABED8;"> channelList</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#C792EA;">    const</span><span style="color:#BABED8;"> channelCopy</span><span style="color:#89DDFF;"> =</span><span style="color:#82AAFF;"> src</span><span style="color:#F07178;">(</span></span>
<span class="line"><span style="color:#F07178;">      [</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">hybrid</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;"> &#39;</span><span style="color:#C3E88D;">vwsize</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;"> &#39;</span><span style="color:#C3E88D;">fullsize</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">indexOf</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">channel</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">&gt;</span><span style="color:#89DDFF;"> -</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;"> ?</span><span style="color:#89DDFF;"> \`</span><span style="color:#C3E88D;">./</span><span style="color:#89DDFF;">\${</span><span style="color:#BABED8;">channel</span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;">/**</span><span style="color:#89DDFF;">\`</span><span style="color:#89DDFF;"> :</span><span style="color:#89DDFF;"> \`</span><span style="color:#C3E88D;">./</span><span style="color:#89DDFF;">\${</span><span style="color:#BABED8;">channel</span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;">/lib/**</span><span style="color:#89DDFF;">\`</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">      .</span><span style="color:#82AAFF;">pipe</span><span style="color:#F07178;">(</span><span style="color:#82AAFF;">dest</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">../lib/</span><span style="color:#89DDFF;">\${</span><span style="color:#BABED8;">channel</span><span style="color:#89DDFF;">}\`</span><span style="color:#F07178;">))</span></span>
<span class="line"><span style="color:#BABED8;">    taskList</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">push</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">channelCopy</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">  }</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">  return</span><span style="color:#82AAFF;"> merge</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">...</span><span style="color:#BABED8;">taskList</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> trash </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;font-style:italic;"> done</span><span style="color:#C792EA;"> =&gt;</span><span style="color:#89DDFF;"> {</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">  // 加入需要删除的一些文件渠道</span></span>
<span class="line"><span style="color:#BABED8;">  channelList</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">push</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">factory</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">  for</span><span style="color:#F07178;"> (</span><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> channel</span><span style="color:#89DDFF;"> of</span><span style="color:#BABED8;"> channelList</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#82AAFF;">    rimraf</span><span style="color:#F07178;">([</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">app</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;"> &#39;</span><span style="color:#C3E88D;">wechat</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;"> &#39;</span><span style="color:#C3E88D;">qq</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">indexOf</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">channel</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">==</span><span style="color:#89DDFF;"> -</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;"> ?</span><span style="color:#89DDFF;"> \`</span><span style="color:#C3E88D;">./</span><span style="color:#89DDFF;">\${</span><span style="color:#BABED8;">channel</span><span style="color:#89DDFF;">}\`</span><span style="color:#89DDFF;"> :</span><span style="color:#89DDFF;"> \`</span><span style="color:#C3E88D;">./</span><span style="color:#89DDFF;">\${</span><span style="color:#BABED8;">channel</span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;">/lib/**</span><span style="color:#89DDFF;">\`</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;"> {},</span><span style="color:#89DDFF;"> ()</span><span style="color:#C792EA;"> =&gt;</span><span style="color:#89DDFF;"> {}</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">  }</span></span>
<span class="line"><span style="color:#BABED8;">  components</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">push</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">loading</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;"> &#39;</span><span style="color:#C3E88D;">icon</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;"> &#39;</span><span style="color:#C3E88D;">base</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">  for</span><span style="color:#F07178;"> (</span><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> channel</span><span style="color:#89DDFF;"> of</span><span style="color:#F07178;"> [</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">app</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;"> &#39;</span><span style="color:#C3E88D;">wechat</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;"> &#39;</span><span style="color:#C3E88D;">qq</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">]) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">    for</span><span style="color:#F07178;"> (</span><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> component</span><span style="color:#89DDFF;"> of</span><span style="color:#BABED8;"> components</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#82AAFF;">      rimraf</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">./</span><span style="color:#89DDFF;">\${</span><span style="color:#BABED8;">channel</span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;">/</span><span style="color:#89DDFF;">\${</span><span style="color:#BABED8;">component</span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;">.less</span><span style="color:#89DDFF;">\`</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;"> {},</span><span style="color:#89DDFF;"> ()</span><span style="color:#C792EA;"> =&gt;</span><span style="color:#89DDFF;"> {}</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">    }</span></span>
<span class="line"><span style="color:#82AAFF;">    rimraf</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">./</span><span style="color:#89DDFF;">\${</span><span style="color:#BABED8;">channel</span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;">/fonts</span><span style="color:#89DDFF;">\`</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;"> {},</span><span style="color:#89DDFF;"> ()</span><span style="color:#C792EA;"> =&gt;</span><span style="color:#89DDFF;"> {}</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#82AAFF;">    rimraf</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">./</span><span style="color:#89DDFF;">\${</span><span style="color:#BABED8;">channel</span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;">/extract</span><span style="color:#89DDFF;">\`</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;"> {},</span><span style="color:#89DDFF;"> ()</span><span style="color:#C792EA;"> =&gt;</span><span style="color:#89DDFF;"> {}</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">  }</span></span>
<span class="line"><span style="color:#82AAFF;">  done</span><span style="color:#F07178;">()</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> empty </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;font-style:italic;"> done</span><span style="color:#C792EA;"> =&gt;</span><span style="color:#82AAFF;"> done</span><span style="color:#BABED8;">()</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> generator </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;font-style:italic;"> type</span><span style="color:#C792EA;"> =&gt;</span><span style="color:#89DDFF;"> {</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">  return</span><span style="color:#82AAFF;"> series</span><span style="color:#F07178;">(</span></span>
<span class="line"><span style="color:#BABED8;">    createExtract</span><span style="color:#89DDFF;">,</span><span style="color:#676E95;font-style:italic;"> // 生成extract目录</span></span>
<span class="line"><span style="color:#BABED8;">    copyLess</span><span style="color:#89DDFF;">,</span><span style="color:#676E95;font-style:italic;"> // 生成less目录</span></span>
<span class="line"><span style="color:#BABED8;">    type</span><span style="color:#89DDFF;"> ==</span><span style="color:#89DDFF;"> &#39;</span><span style="color:#C3E88D;">build</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;"> ?</span><span style="color:#BABED8;"> copySameChannel</span><span style="color:#89DDFF;"> :</span><span style="color:#BABED8;"> empty</span><span style="color:#89DDFF;">,</span><span style="color:#676E95;font-style:italic;"> // 复制相同样式的渠道</span></span>
<span class="line"><span style="color:#BABED8;">    compileBase</span><span style="color:#89DDFF;">,</span><span style="color:#676E95;font-style:italic;"> // 编译各渠道基础样式</span></span>
<span class="line"><span style="color:#BABED8;">    compileHybrid</span><span style="color:#89DDFF;">,</span><span style="color:#676E95;font-style:italic;"> // 编译各渠道加类名样式</span></span>
<span class="line"><span style="color:#BABED8;">    connectHybrid</span><span style="color:#89DDFF;">,</span><span style="color:#676E95;font-style:italic;"> // 生成混合包</span></span>
<span class="line"><span style="color:#BABED8;">    type</span><span style="color:#89DDFF;"> ==</span><span style="color:#89DDFF;"> &#39;</span><span style="color:#C3E88D;">build</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;"> ?</span><span style="color:#82AAFF;"> parallel</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">copyFullSize</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> copyVWSize</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> empty</span><span style="color:#89DDFF;">,</span><span style="color:#676E95;font-style:italic;"> // 生成全尺寸样式包</span></span>
<span class="line"><span style="color:#BABED8;">    copyFont</span><span style="color:#89DDFF;">,</span><span style="color:#676E95;font-style:italic;"> // copy字体文件</span></span>
<span class="line"><span style="color:#BABED8;">    copyToLib</span><span style="color:#89DDFF;">,</span><span style="color:#676E95;font-style:italic;"> // 复制到lib</span></span>
<span class="line"><span style="color:#BABED8;">    trash</span><span style="color:#676E95;font-style:italic;"> // 删除生成的文件</span></span>
<span class="line"><span style="color:#F07178;">  )</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">task</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">build</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;font-style:italic;"> done</span><span style="color:#C792EA;"> =&gt;</span><span style="color:#89DDFF;"> {</span></span>
<span class="line"><span style="color:#82AAFF;">    generator</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">build</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)()</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#BABED8;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br></div></div><h3 id="混合样式" tabindex="-1">混合样式 <a class="header-anchor" href="#混合样式" aria-label="Permalink to &quot;混合样式&quot;">​</a></h3><p>通过类名区分多站点样式，使用混合样式（体积较大）</p><div class="language-html line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">html</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#676E95;font-style:italic;">&lt;!-- 在根节点加类名，channel为wechat、app、elong、qq、touch其中之一，会获取该渠道类名下的样式 --&gt;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">&lt;!-- 不加类名区分则默认为wechat样式 --&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">div</span><span style="color:#C792EA;"> id</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">app</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;"> :class</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">channel</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;&lt;/</span><span style="color:#F07178;">div</span><span style="color:#89DDFF;">&gt;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#676E95;font-style:italic;"> //全量引入混合样式</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;"> import</span><span style="color:#89DDFF;"> &#39;</span><span style="color:#C3E88D;">tc-flight-siskin/lib/hybrid/index.css</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> //单一组件引入混合样式示例（以button为例）</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;"> import</span><span style="color:#89DDFF;"> &#39;</span><span style="color:#C3E88D;">tc-flight-siskin/lib/hybrid/button.css</span><span style="color:#89DDFF;">&#39;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="分渠道样式" tabindex="-1">分渠道样式 <a class="header-anchor" href="#分渠道样式" aria-label="Permalink to &quot;分渠道样式&quot;">​</a></h3><p>通过引入不同样式单css包加载样式，</p><div class="language-javascript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#676E95;font-style:italic;">// 构建时可通过环境变量区别渠道，通过别名引入</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// npm scripts，构建脚本加环境变量</span></span>
<span class="line"><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">scripts</span><span style="color:#89DDFF;">&quot;</span><span style="color:#BABED8;">: </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">  &quot;</span><span style="color:#F07178;">build:app</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">channel=app</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// webpack config设置别名</span></span>
<span class="line"><span style="color:#FFCB6B;">alias</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;"> {</span></span>
<span class="line"><span style="color:#89DDFF;">  &quot;</span><span style="color:#C3E88D;">tc-flight-siskin-theme</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">: </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">tc-flight-siskin/lib/</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> +</span><span style="color:#BABED8;"> process</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">env</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">channel</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">  // 全尺寸样式路径</span></span>
<span class="line"><span style="color:#89DDFF;">  &quot;</span><span style="color:#C3E88D;">tc-flight-siskin-theme</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">: </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">tc-flight-siskin/lib/fullsize</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> +</span><span style="color:#BABED8;"> process</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">env</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">channel</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">},</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// 全量引用样式</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#89DDFF;"> &#39;</span><span style="color:#C3E88D;">tc-flight-siskin-theme/index.css</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// 单个组件引用样式</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#89DDFF;"> &#39;</span><span style="color:#C3E88D;">tc-flight-siskin-theme/button.css</span><span style="color:#89DDFF;">&#39;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#676E95;font-style:italic;">//app样式</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#89DDFF;"> &#39;</span><span style="color:#C3E88D;">tc-flight-siskin/lib/app/index.css</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//touch站样式</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#89DDFF;"> &#39;</span><span style="color:#C3E88D;">tc-flight-siskin/lib/touch/index.css</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//微信样式</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#89DDFF;"> &#39;</span><span style="color:#C3E88D;">tc-flight-siskin/lib/wechat/index.css</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//艺龙样式</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#89DDFF;"> &#39;</span><span style="color:#C3E88D;">tc-flight-siskin/lib/elong/index.css</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//qq样式</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#89DDFF;"> &#39;</span><span style="color:#C3E88D;">tc-flight-siskin/lib/qq/index.css</span><span style="color:#89DDFF;">&#39;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="全尺寸样式" tabindex="-1">全尺寸样式 <a class="header-anchor" href="#全尺寸样式" aria-label="Permalink to &quot;全尺寸样式&quot;">​</a></h3><p>基于<code>750px</code>，全量引用样式与混合引用规则同上</p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#676E95;font-style:italic;">//全尺寸混合样式</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#89DDFF;"> &#39;</span><span style="color:#C3E88D;">tc-flight-siskin/lib/fullsize/hybrid/index.css</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//全尺寸app样式</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#89DDFF;"> &#39;</span><span style="color:#C3E88D;">tc-flight-siskin/lib/fullsize/app/index.css</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//全尺寸touch站样式</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#89DDFF;"> &#39;</span><span style="color:#C3E88D;">tc-flight-siskin/lib/fullsize/touch/index.css</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//全尺寸微信样式</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#89DDFF;"> &#39;</span><span style="color:#C3E88D;">tc-flight-siskin/lib/fullsize/wechat/index.css</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//全尺寸艺龙样式</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#89DDFF;"> &#39;</span><span style="color:#C3E88D;">tc-flight-siskin/lib/fullsize/elong/index.css</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//全尺寸qq样式</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#89DDFF;"> &#39;</span><span style="color:#C3E88D;">tc-flight-siskin/lib/fullsize/qq/index.css</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// 单个组件引用样式(app渠道的button示例)</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#89DDFF;"> &#39;</span><span style="color:#C3E88D;">tc-flight-siskin/lib/fullsize/app/button.css</span><span style="color:#89DDFF;">&#39;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h3 id="vw样式" tabindex="-1">VW样式 <a class="header-anchor" href="#vw样式" aria-label="Permalink to &quot;VW样式&quot;">​</a></h3><p>基于<code>375px</code>，全量引用样式与混合引用规则同上</p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#676E95;font-style:italic;">//VW包混合样式</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#89DDFF;"> &#39;</span><span style="color:#C3E88D;">tc-flight-siskin/lib/vwsize/hybrid/index.css</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//VW包app样式</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#89DDFF;"> &#39;</span><span style="color:#C3E88D;">tc-flight-siskin/lib/vwsize/app/index.css</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//VW包touch站样式</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#89DDFF;"> &#39;</span><span style="color:#C3E88D;">tc-flight-siskin/lib/vwsize/touch/index.css</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//VW包微信样式</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#89DDFF;"> &#39;</span><span style="color:#C3E88D;">tc-flight-siskin/lib/vwsize/wechat/index.css</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//VW包艺龙样式</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#89DDFF;"> &#39;</span><span style="color:#C3E88D;">tc-flight-siskin/lib/vwsize/elong/index.css</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//VW包qq样式</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#89DDFF;"> &#39;</span><span style="color:#C3E88D;">tc-flight-siskin/lib/vwsize/qq/index.css</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// 单个组件引用样式(app渠道的button示例)</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#89DDFF;"> &#39;</span><span style="color:#C3E88D;">tc-flight-siskin/lib/vwsize/app/button.css</span><span style="color:#89DDFF;">&#39;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h2 id="gulp插件" tabindex="-1">gulp插件 <a class="header-anchor" href="#gulp插件" aria-label="Permalink to &quot;gulp插件&quot;">​</a></h2><p>pipe 意味管道，很好理解，文件流通过 pipe 管道，那么就可以在这个过程中对文件流进行操作，定制自己的需求。所有的处理都是在 pipe 中进行的。在组件库样式包的处理中，我们也实现了一个<code>gulp</code>插件,用来给混合包加上对应渠道的<code>class</code>类名.</p><h3 id="第一步-插件定义" tabindex="-1">第一步：插件定义 <a class="header-anchor" href="#第一步-插件定义" aria-label="Permalink to &quot;第一步：插件定义&quot;">​</a></h3><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> PluginError </span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;"> require</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">plugin-error</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">)</span><span style="color:#89DDFF;">;</span><span style="color:#676E95;font-style:italic;"> // 错误处理</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> through </span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;"> require</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">through2</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">)</span><span style="color:#89DDFF;">;</span><span style="color:#676E95;font-style:italic;"> // 流处理包，整个gulp流的处理</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> cssWrap </span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;"> require</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./cssWrap</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">)</span><span style="color:#89DDFF;">;</span><span style="color:#676E95;font-style:italic;"> // 业务处理工程</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> PLUGIN_NAME </span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;"> &#39;</span><span style="color:#C3E88D;">gulp-css-wrap</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">module.exports</span><span style="color:#89DDFF;"> =</span><span style="color:#89DDFF;"> (</span><span style="color:#BABED8;font-style:italic;">options</span><span style="color:#89DDFF;"> =</span><span style="color:#89DDFF;"> {})</span><span style="color:#C792EA;"> =&gt;</span><span style="color:#89DDFF;"> {</span></span>
<span class="line"><span style="color:#C792EA;">  function</span><span style="color:#82AAFF;"> transform</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">file</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;font-style:italic;"> encoding</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;font-style:italic;"> callback</span><span style="color:#89DDFF;">)</span><span style="color:#89DDFF;"> {</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">    if</span><span style="color:#F07178;"> (</span><span style="color:#BABED8;">file</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">isNull</span><span style="color:#F07178;">()) </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#82AAFF;"> callback</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">null,</span><span style="color:#BABED8;"> file</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">    if</span><span style="color:#F07178;"> (</span><span style="color:#BABED8;">file</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">isStream</span><span style="color:#F07178;">()) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">      return</span><span style="color:#82AAFF;"> callback</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">new</span><span style="color:#82AAFF;"> PluginError</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">PLUGIN_NAME</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;"> &#39;</span><span style="color:#C3E88D;">Streaming not supported</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">))</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">    }</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">    // 执行业务</span></span>
<span class="line"><span style="color:#BABED8;">    file</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">contents</span><span style="color:#89DDFF;"> =</span><span style="color:#BABED8;"> Buffer</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">from</span><span style="color:#F07178;">(</span><span style="color:#82AAFF;">cssWrap</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">file</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">contents</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">toString</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> options</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> file</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">path</span><span style="color:#F07178;">))</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">    callback</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">null,</span><span style="color:#BABED8;"> file</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">  return</span><span style="color:#BABED8;"> through</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">obj</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">transform</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><h3 id="第二步" tabindex="-1">第二步 <a class="header-anchor" href="#第二步" aria-label="Permalink to &quot;第二步&quot;">​</a></h3><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> path </span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;"> require</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">path</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> fs </span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;"> require</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">fs-extra</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> deepmerge </span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;"> require</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">deepmerge</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> cssParse </span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;"> require</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">css-parse</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> cssStringify </span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;"> require</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">css-stringify</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> chalk </span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;"> require</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">chalk</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> log </span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;"> require</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">fancy-log</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> processRules </span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;"> (</span><span style="color:#BABED8;font-style:italic;">list</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;font-style:italic;"> options</span><span style="color:#89DDFF;">)</span><span style="color:#C792EA;"> =&gt;</span><span style="color:#BABED8;"> list</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">map</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">r</span><span style="color:#89DDFF;">)</span><span style="color:#C792EA;"> =&gt;</span><span style="color:#89DDFF;"> {</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">  if</span><span style="color:#F07178;"> (</span><span style="color:#BABED8;">r</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">selectors</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">    r</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">selectors</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">forEach</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">s</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;font-style:italic;"> index</span><span style="color:#89DDFF;">)</span><span style="color:#C792EA;"> =&gt;</span><span style="color:#89DDFF;"> {</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">      if</span><span style="color:#F07178;"> (</span><span style="color:#BABED8;">options</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">skip</span><span style="color:#89DDFF;"> &amp;&amp;</span><span style="color:#BABED8;"> options</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">skip</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">test</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">s</span><span style="color:#F07178;">)) </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">      let</span><span style="color:#BABED8;"> selector</span><span style="color:#89DDFF;"> =</span><span style="color:#BABED8;"> options</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">selector</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">      // 关键代码，将类名进去前缀拼接</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">      if</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">typeof</span><span style="color:#BABED8;"> selector</span><span style="color:#89DDFF;"> ===</span><span style="color:#89DDFF;"> &#39;</span><span style="color:#C3E88D;">string</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">        selector</span><span style="color:#89DDFF;"> =</span><span style="color:#BABED8;"> options</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">selector</span><span style="color:#89DDFF;"> ?</span><span style="color:#89DDFF;"> \`\${</span><span style="color:#BABED8;">options</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">selector</span><span style="color:#89DDFF;">}</span><span style="color:#89DDFF;"> \${</span><span style="color:#BABED8;">s</span><span style="color:#89DDFF;">}\`</span><span style="color:#89DDFF;"> :</span><span style="color:#BABED8;"> s</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">      }</span><span style="color:#89DDFF;font-style:italic;"> else</span><span style="color:#89DDFF;"> {</span></span>
<span class="line"><span style="color:#C792EA;">        let</span><span style="color:#BABED8;"> arr</span><span style="color:#89DDFF;"> =</span><span style="color:#F07178;"> []</span></span>
<span class="line"><span style="color:#BABED8;">        options</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">selector</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">forEach</span><span style="color:#F07178;">(</span><span style="color:#BABED8;font-style:italic;">e</span><span style="color:#C792EA;"> =&gt;</span><span style="color:#89DDFF;"> {</span></span>
<span class="line"><span style="color:#BABED8;">          arr</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">push</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">\`\${</span><span style="color:#BABED8;">e</span><span style="color:#89DDFF;">}</span><span style="color:#89DDFF;"> \${</span><span style="color:#BABED8;">s</span><span style="color:#89DDFF;">}\`</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">        }</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#BABED8;">        selector</span><span style="color:#89DDFF;"> =</span><span style="color:#BABED8;"> arr</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">join</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">, </span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">      }</span></span>
<span class="line"><span style="color:#BABED8;">      r</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">selectors</span><span style="color:#F07178;">[</span><span style="color:#BABED8;">index</span><span style="color:#F07178;">] </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> selector</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">    }</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">  }</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">  if</span><span style="color:#F07178;"> (</span><span style="color:#BABED8;">r</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">type</span><span style="color:#89DDFF;"> ===</span><span style="color:#89DDFF;"> &#39;</span><span style="color:#C3E88D;">media</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">    r</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">rules</span><span style="color:#89DDFF;"> =</span><span style="color:#82AAFF;"> processRules</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">r</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">rules</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> options</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">  }</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">  return</span><span style="color:#BABED8;"> r</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#BABED8;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> cssWrap </span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;"> (</span><span style="color:#BABED8;font-style:italic;">string</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;font-style:italic;"> options</span><span style="color:#89DDFF;"> =</span><span style="color:#89DDFF;"> {},</span><span style="color:#BABED8;font-style:italic;"> filePath</span><span style="color:#89DDFF;"> =</span><span style="color:#89DDFF;"> &#39;</span><span style="color:#89DDFF;"> &#39;</span><span style="color:#89DDFF;">)</span><span style="color:#C792EA;"> =&gt;</span><span style="color:#89DDFF;"> {</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">  // 初始化参数</span></span>
<span class="line"><span style="color:#C792EA;">  const</span><span style="color:#BABED8;"> _options</span><span style="color:#89DDFF;"> =</span><span style="color:#82AAFF;"> deepmerge</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    selector</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;"> &#39;</span><span style="color:#C3E88D;">.css-wrap</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    skip</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;"> null,</span></span>
<span class="line"><span style="color:#F07178;">    log</span><span style="color:#89DDFF;">:</span><span style="color:#FF9CAC;"> true</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">  },</span><span style="color:#BABED8;"> options</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">  // 读取文件</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">  if</span><span style="color:#F07178;"> (</span><span style="color:#BABED8;">fs</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">existsSync</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">path</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">resolve</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">string</span><span style="color:#F07178;">))) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">    try</span><span style="color:#89DDFF;"> {</span></span>
<span class="line"><span style="color:#BABED8;">      string</span><span style="color:#89DDFF;"> =</span><span style="color:#BABED8;"> fs</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">readFileSync</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">string</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">toString</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">    }</span><span style="color:#89DDFF;font-style:italic;"> catch</span><span style="color:#F07178;"> (</span><span style="color:#BABED8;">error</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">      if</span><span style="color:#F07178;"> (</span><span style="color:#BABED8;">log</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#C792EA;">        const</span><span style="color:#BABED8;"> fileName</span><span style="color:#89DDFF;"> =</span><span style="color:#BABED8;"> path</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">basename</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">filePath</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#82AAFF;">        log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">\`\${</span><span style="color:#BABED8;">chalk</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">yellow</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">css-wrap: skipping empty file -&gt;</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">)</span><span style="color:#89DDFF;">}</span><span style="color:#89DDFF;"> \${</span><span style="color:#BABED8;">fileName</span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;">\\n</span><span style="color:#89DDFF;">\`</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">      }</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">      return</span><span style="color:#89DDFF;"> &#39;&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">    }</span></span>
<span class="line"><span style="color:#89DDFF;">  }</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">  // 解析css</span></span>
<span class="line"><span style="color:#C792EA;">  const</span><span style="color:#BABED8;"> css</span><span style="color:#89DDFF;"> =</span><span style="color:#82AAFF;"> cssParse</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">string</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">  // 处理css</span></span>
<span class="line"><span style="color:#BABED8;">  css</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">stylesheet</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">rules</span><span style="color:#89DDFF;"> =</span><span style="color:#82AAFF;"> processRules</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">css</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">stylesheet</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">rules</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> _options</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">  // 序列化css然后返回</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">  return</span><span style="color:#82AAFF;"> cssStringify</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">css</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">module.exports</span><span style="color:#89DDFF;"> =</span><span style="color:#BABED8;"> cssWrap</span><span style="color:#89DDFF;">;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br></div></div><ul><li>cssParse 解析css</li></ul><p><img src="`+o+'" alt="img"></p>',36),r=[c];function t(F,y,D,i,b,B){return a(),n("div",null,r)}const u=s(e,[["render",t]]);export{A as __pageData,u as default};
