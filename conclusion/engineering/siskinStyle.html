<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>ç»„ä»¶åº“ä¹‹æ ·å¼åŒ… | PengYYY</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="Happy Life ğŸ€,  Working Smooth ğŸ’»">
    
    <link rel="preload" href="/my-blog/assets/css/0.styles.3606043a.css" as="style"><link rel="preload" href="/my-blog/assets/js/app.2604ea65.js" as="script"><link rel="preload" href="/my-blog/assets/js/2.df0a347f.js" as="script"><link rel="preload" href="/my-blog/assets/js/40.d08bd8a6.js" as="script"><link rel="prefetch" href="/my-blog/assets/js/10.2801256c.js"><link rel="prefetch" href="/my-blog/assets/js/100.413fb5c7.js"><link rel="prefetch" href="/my-blog/assets/js/101.8b6a893c.js"><link rel="prefetch" href="/my-blog/assets/js/102.19f7bd0b.js"><link rel="prefetch" href="/my-blog/assets/js/103.f2e53e80.js"><link rel="prefetch" href="/my-blog/assets/js/104.1105cee1.js"><link rel="prefetch" href="/my-blog/assets/js/105.dc657231.js"><link rel="prefetch" href="/my-blog/assets/js/106.a2d51144.js"><link rel="prefetch" href="/my-blog/assets/js/107.4219c414.js"><link rel="prefetch" href="/my-blog/assets/js/108.ea1c71c8.js"><link rel="prefetch" href="/my-blog/assets/js/109.dce88455.js"><link rel="prefetch" href="/my-blog/assets/js/11.5c98febd.js"><link rel="prefetch" href="/my-blog/assets/js/110.3f9916df.js"><link rel="prefetch" href="/my-blog/assets/js/111.28bde672.js"><link rel="prefetch" href="/my-blog/assets/js/112.d179a417.js"><link rel="prefetch" href="/my-blog/assets/js/113.2a9096c0.js"><link rel="prefetch" href="/my-blog/assets/js/114.e716cea3.js"><link rel="prefetch" href="/my-blog/assets/js/115.329497dd.js"><link rel="prefetch" href="/my-blog/assets/js/116.649055b8.js"><link rel="prefetch" href="/my-blog/assets/js/117.87a7785b.js"><link rel="prefetch" href="/my-blog/assets/js/118.21fb68b5.js"><link rel="prefetch" href="/my-blog/assets/js/119.391e58af.js"><link rel="prefetch" href="/my-blog/assets/js/12.dea5f0e5.js"><link rel="prefetch" href="/my-blog/assets/js/120.b4dc928c.js"><link rel="prefetch" href="/my-blog/assets/js/121.476e0f3d.js"><link rel="prefetch" href="/my-blog/assets/js/122.9eac55d1.js"><link rel="prefetch" href="/my-blog/assets/js/123.37f6dfce.js"><link rel="prefetch" href="/my-blog/assets/js/13.9ed8968b.js"><link rel="prefetch" href="/my-blog/assets/js/14.0b1a70c0.js"><link rel="prefetch" href="/my-blog/assets/js/15.8925af36.js"><link rel="prefetch" href="/my-blog/assets/js/16.c87608d1.js"><link rel="prefetch" href="/my-blog/assets/js/17.07edf7b8.js"><link rel="prefetch" href="/my-blog/assets/js/18.87ec1856.js"><link rel="prefetch" href="/my-blog/assets/js/19.f0ed1f96.js"><link rel="prefetch" href="/my-blog/assets/js/20.91cc4163.js"><link rel="prefetch" href="/my-blog/assets/js/21.b7b0fa5d.js"><link rel="prefetch" href="/my-blog/assets/js/22.3931e563.js"><link rel="prefetch" href="/my-blog/assets/js/23.8176e093.js"><link rel="prefetch" href="/my-blog/assets/js/24.38727ada.js"><link rel="prefetch" href="/my-blog/assets/js/25.61f6f70d.js"><link rel="prefetch" href="/my-blog/assets/js/26.7907dbbb.js"><link rel="prefetch" href="/my-blog/assets/js/27.f1af7215.js"><link rel="prefetch" href="/my-blog/assets/js/28.f51d54bd.js"><link rel="prefetch" href="/my-blog/assets/js/29.753ac330.js"><link rel="prefetch" href="/my-blog/assets/js/3.d7834cfe.js"><link rel="prefetch" href="/my-blog/assets/js/30.2b217e50.js"><link rel="prefetch" href="/my-blog/assets/js/31.fbd822fb.js"><link rel="prefetch" href="/my-blog/assets/js/32.2a92b4f5.js"><link rel="prefetch" href="/my-blog/assets/js/33.5e4449ca.js"><link rel="prefetch" href="/my-blog/assets/js/34.fb5f1bf7.js"><link rel="prefetch" href="/my-blog/assets/js/35.5bd53f3e.js"><link rel="prefetch" href="/my-blog/assets/js/36.e302888b.js"><link rel="prefetch" href="/my-blog/assets/js/37.ac95653e.js"><link rel="prefetch" href="/my-blog/assets/js/38.429cb560.js"><link rel="prefetch" href="/my-blog/assets/js/39.545b355d.js"><link rel="prefetch" href="/my-blog/assets/js/4.03235a2f.js"><link rel="prefetch" href="/my-blog/assets/js/41.2f6e5521.js"><link rel="prefetch" href="/my-blog/assets/js/42.5333af86.js"><link rel="prefetch" href="/my-blog/assets/js/43.53d6c191.js"><link rel="prefetch" href="/my-blog/assets/js/44.dbfa7349.js"><link rel="prefetch" href="/my-blog/assets/js/45.2faa7e29.js"><link rel="prefetch" href="/my-blog/assets/js/46.09e947ee.js"><link rel="prefetch" href="/my-blog/assets/js/47.cf9ba86d.js"><link rel="prefetch" href="/my-blog/assets/js/48.31acaf8d.js"><link rel="prefetch" href="/my-blog/assets/js/49.2ba86449.js"><link rel="prefetch" href="/my-blog/assets/js/5.a556b432.js"><link rel="prefetch" href="/my-blog/assets/js/50.5d9ee899.js"><link rel="prefetch" href="/my-blog/assets/js/51.24812116.js"><link rel="prefetch" href="/my-blog/assets/js/52.06419b22.js"><link rel="prefetch" href="/my-blog/assets/js/53.93f43246.js"><link rel="prefetch" href="/my-blog/assets/js/54.5c51a3ad.js"><link rel="prefetch" href="/my-blog/assets/js/55.c5a64763.js"><link rel="prefetch" href="/my-blog/assets/js/56.32045283.js"><link rel="prefetch" href="/my-blog/assets/js/57.0934b785.js"><link rel="prefetch" href="/my-blog/assets/js/58.14242ce5.js"><link rel="prefetch" href="/my-blog/assets/js/59.c1621902.js"><link rel="prefetch" href="/my-blog/assets/js/6.0f1039b1.js"><link rel="prefetch" href="/my-blog/assets/js/60.479a0f18.js"><link rel="prefetch" href="/my-blog/assets/js/61.6a213269.js"><link rel="prefetch" href="/my-blog/assets/js/62.f377f50a.js"><link rel="prefetch" href="/my-blog/assets/js/63.736aadbf.js"><link rel="prefetch" href="/my-blog/assets/js/64.d3ae2ac6.js"><link rel="prefetch" href="/my-blog/assets/js/65.9a097331.js"><link rel="prefetch" href="/my-blog/assets/js/66.76d312c0.js"><link rel="prefetch" href="/my-blog/assets/js/67.1734a5bd.js"><link rel="prefetch" href="/my-blog/assets/js/68.6facbfbe.js"><link rel="prefetch" href="/my-blog/assets/js/69.003da1e2.js"><link rel="prefetch" href="/my-blog/assets/js/7.387d883a.js"><link rel="prefetch" href="/my-blog/assets/js/70.457ddd35.js"><link rel="prefetch" href="/my-blog/assets/js/71.c0dc3455.js"><link rel="prefetch" href="/my-blog/assets/js/72.853b5102.js"><link rel="prefetch" href="/my-blog/assets/js/73.213c3a58.js"><link rel="prefetch" href="/my-blog/assets/js/74.edcf6826.js"><link rel="prefetch" href="/my-blog/assets/js/75.2cb1e219.js"><link rel="prefetch" href="/my-blog/assets/js/76.10de5c1e.js"><link rel="prefetch" href="/my-blog/assets/js/77.3d570e45.js"><link rel="prefetch" href="/my-blog/assets/js/78.9ee516da.js"><link rel="prefetch" href="/my-blog/assets/js/79.719b87ef.js"><link rel="prefetch" href="/my-blog/assets/js/8.afc6d5ca.js"><link rel="prefetch" href="/my-blog/assets/js/80.f717798f.js"><link rel="prefetch" href="/my-blog/assets/js/81.942f7986.js"><link rel="prefetch" href="/my-blog/assets/js/82.46077de0.js"><link rel="prefetch" href="/my-blog/assets/js/83.1e7399de.js"><link rel="prefetch" href="/my-blog/assets/js/84.8403292d.js"><link rel="prefetch" href="/my-blog/assets/js/85.a20cd9b5.js"><link rel="prefetch" href="/my-blog/assets/js/86.8c7c71e2.js"><link rel="prefetch" href="/my-blog/assets/js/87.03e27673.js"><link rel="prefetch" href="/my-blog/assets/js/88.990dbbfb.js"><link rel="prefetch" href="/my-blog/assets/js/89.217aa324.js"><link rel="prefetch" href="/my-blog/assets/js/9.0705089f.js"><link rel="prefetch" href="/my-blog/assets/js/90.f572d84d.js"><link rel="prefetch" href="/my-blog/assets/js/91.11dd6cc4.js"><link rel="prefetch" href="/my-blog/assets/js/92.fbcd5c2e.js"><link rel="prefetch" href="/my-blog/assets/js/93.413301b4.js"><link rel="prefetch" href="/my-blog/assets/js/94.d212961a.js"><link rel="prefetch" href="/my-blog/assets/js/95.db22ac2e.js"><link rel="prefetch" href="/my-blog/assets/js/96.80b39ad2.js"><link rel="prefetch" href="/my-blog/assets/js/97.f3920b6d.js"><link rel="prefetch" href="/my-blog/assets/js/98.acc782da.js"><link rel="prefetch" href="/my-blog/assets/js/99.58988589.js">
    <link rel="stylesheet" href="/my-blog/assets/css/0.styles.3606043a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/my-blog/" class="home-link router-link-active"><!----> <span class="site-name">PengYYY</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/my-blog/fontend/" class="nav-link">
  å‰ç«¯
</a></div><div class="nav-item"><a href="/my-blog/algorithm/" class="nav-link">
  ç®—æ³•
</a></div><div class="nav-item"><a href="/my-blog/backend/" class="nav-link">
  åç«¯
</a></div><div class="nav-item"><a href="/my-blog/network/" class="nav-link">
  ç½‘ç»œ
</a></div><div class="nav-item"><a href="/my-blog/conclusion/" class="nav-link router-link-active">
  æ€»ç»“
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/my-blog/fontend/" class="nav-link">
  å‰ç«¯
</a></div><div class="nav-item"><a href="/my-blog/algorithm/" class="nav-link">
  ç®—æ³•
</a></div><div class="nav-item"><a href="/my-blog/backend/" class="nav-link">
  åç«¯
</a></div><div class="nav-item"><a href="/my-blog/network/" class="nav-link">
  ç½‘ç»œ
</a></div><div class="nav-item"><a href="/my-blog/conclusion/" class="nav-link router-link-active">
  æ€»ç»“
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>å·¥ç¨‹ä¸å®è·µ</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/my-blog/conclusion/engineering/engineering.html" class="sidebar-link">å·¥ç¨‹åŒ–</a></li><li><a href="/my-blog/conclusion/engineering/siskinImport.html" class="sidebar-link">ç»„ä»¶åº“ä¹‹æŒ‰éœ€åŠ è½½</a></li><li><a href="/my-blog/conclusion/engineering/siskinStyle.html" aria-current="page" class="active sidebar-link">ç»„ä»¶åº“ä¹‹æ ·å¼åŒ…</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/my-blog/conclusion/engineering/siskinStyle.html#æ–‡ä»¶ç›®å½•å¦‚ä¸‹" class="sidebar-link">æ–‡ä»¶ç›®å½•å¦‚ä¸‹</a></li><li class="sidebar-sub-header"><a href="/my-blog/conclusion/engineering/siskinStyle.html#gulpæ’ä»¶" class="sidebar-link">gulpæ’ä»¶</a></li></ul></li><li><a href="/my-blog/conclusion/engineering/unitTest.html" class="sidebar-link">ç»„ä»¶å•å…ƒæµ‹è¯•</a></li><li><a href="/my-blog/conclusion/engineering/buildSystem.html" class="sidebar-link">å…³äºé¡µé¢æ­å»ºç³»ç»Ÿ</a></li><li><a href="/my-blog/conclusion/engineering/bridge.html" class="sidebar-link">JSBridge</a></li><li><a href="/my-blog/conclusion/engineering/jwt.html" class="sidebar-link">jwtä¸session-cookie</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>æ¡†æ¶åŸç†</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>javaScript</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>æ‚ä¸ƒæ‚å…«çš„</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="ç»„ä»¶åº“ä¹‹æ ·å¼åŒ…"><a href="#ç»„ä»¶åº“ä¹‹æ ·å¼åŒ…" class="header-anchor">#</a> ç»„ä»¶åº“ä¹‹æ ·å¼åŒ…</h1> <p>åœ¨åšç»„ä»¶åº“çš„æ—¶å€™ï¼Œéœ€è¦æ»¡è¶³ä½¿ç”¨æ–¹çš„5ä¸ªæ¸ é“ <code>wechat app elong qq touch</code>5ä¸ªæ¸ é“ä¸»é¢˜æ ·å¼,ä¸€å¥—æ··åˆæ ·å¼(ç”¨äºä½¿ç”¨classç±»åæ¥åŠ è½½ä¸åŒæ ·å¼çš„åº”ç”¨)ï¼Œä¸€å¥—å…¨å°ºå¯¸æ ·å¼(åŸºäº750px)çš„åº”ç”¨ï¼Œä¸€å¥—vwæ ·å¼ï¼ˆä»¥375pxåŸºå‡†ï¼‰ã€‚ç®€å•è¯´ä¸€äº›æ•´ä¸ªæµç¨‹:</p> <h2 id="æ–‡ä»¶ç›®å½•å¦‚ä¸‹"><a href="#æ–‡ä»¶ç›®å½•å¦‚ä¸‹" class="header-anchor">#</a> æ–‡ä»¶ç›®å½•å¦‚ä¸‹</h2> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>â”œâ”€â”€ app
â”‚   â””â”€â”€ variables.less
â”œâ”€â”€ qq
â”‚   â””â”€â”€ variables.less
â”œâ”€â”€ wechat
â”‚   â””â”€â”€ variables.less
â”œâ”€â”€ default
â”‚   â”œâ”€â”€ action-sheet.less
â”‚   â”œâ”€â”€ anchor.less
â”‚   â”œâ”€â”€ base.less
â”‚   â”œâ”€â”€ button.less
â”‚   â”œâ”€â”€ calendar.less
â”‚   â”œâ”€â”€ card.less
â”‚   â”œâ”€â”€ checkbox.less
â”‚   â”œâ”€â”€ city-picker.less
â”‚   â”œâ”€â”€ date-picker.less
â”‚   â”œâ”€â”€ dialog.less
â”‚   â”œâ”€â”€ fonts
â”‚   â”‚   â”œâ”€â”€ iconfont.ttf
â”‚   â”‚   â””â”€â”€ iconfont.woff
â”‚   â”œâ”€â”€ icon.less
â”‚   â”œâ”€â”€ image-upload.less
â”‚   â”œâ”€â”€ index.less
â”‚   â”œâ”€â”€ input-number.less
â”‚   â”œâ”€â”€ label.less
â”‚   â”œâ”€â”€ name-to-spell.less
â”‚   â”œâ”€â”€ notice.less
â”‚   â”œâ”€â”€ picker.less
â”‚   â”œâ”€â”€ popup.less
â”‚   â”œâ”€â”€ radio.less
â”‚   â”œâ”€â”€ skeleton.less
â”‚   â”œâ”€â”€ slide.less
â”‚   â”œâ”€â”€ slider.less
â”‚   â”œâ”€â”€ swiper.less
â”‚   â”œâ”€â”€ switch.less
â”‚   â”œâ”€â”€ tab-bar.less
â”‚   â”œâ”€â”€ table.less
â”‚   â”œâ”€â”€ time-line.less
â”‚   â”œâ”€â”€ tip.less
â”‚   â”œâ”€â”€ toast.less
â”‚   â”œâ”€â”€ transition.less
â”‚   â””â”€â”€ variables.less
â”œâ”€â”€ gulpfile.js
â”œâ”€â”€ less-extract.js

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br></div></div><p>æ¯ä¸ªæ¸ é“çš„variables.lessçš„ä¸­å­˜æ”¾å„æ¸ é“çš„ç¯å¢ƒå˜é‡ï¼Œdefaultå­˜æ”¾åŸºç¡€æ ·å¼ä¿¡æ¯ã€‚</p> <p>æœ€ç»ˆå¾—åˆ°çš„äº§ç‰©</p> <p><img src="https://gitee.com/PENG_YUE/myImg/raw/master/uPic/7tMW11.png" alt="img"></p> <p>é¦–å…ˆåˆ†å„æ¸ é“ï¼Œ<code>fullsize</code>å’Œ<code>vwsize</code>åˆ†åˆ«å¯¹åº”äºŒå€å±å’Œ<code>vw</code>å•ä½çš„æ ·å¼åŒ…ï¼Œ<code>hybrid</code>åŒ…ç”¨äºä½¿ç”¨æ–¹ä½¿ç”¨<code>class</code>æ¥åŒºåˆ†æ¸ é“çš„åŒ…ã€‚</p> <h3 id="æ‰“åŒ…æµç¨‹"><a href="#æ‰“åŒ…æµç¨‹" class="header-anchor">#</a> æ‰“åŒ…æµç¨‹</h3> <ul><li>ç”Ÿæˆextractç›®å½•ï¼ˆåªåŒ…å«å˜é‡åçš„lessæ–‡ä»¶ï¼‰ç”¨äºç”Ÿäº§æ··åˆåŒ…ï¼Œä¼˜åŒ–ä»£ç ä½“ç§¯</li> <li>ä»default(æ ·å¼ä¸ºwechat)æ–‡ä»¶ä¸­å¤åˆ¶å„ç»„ä»¶æ ·å¼æ–‡ä»¶åˆ°å„æ¸ é“ç›®å½•ä¸‹</li> <li>å¤åˆ¶ç›¸åŒæ ·å¼çš„æ¸ é“</li> <li>ç¼–è¯‘å„æ¸ é“åŸºç¡€æ ·å¼</li> <li>ç¼–è¯‘å„æ¸ é“extractç›®å½•åˆ°factoryç›®å½•ï¼Œç”Ÿæˆå¸¦ç±»åçš„æ ·å¼æ–‡ä»¶</li> <li>è¿æ¥å„æ¸ é“çš„åŸºç¡€æ ·å¼ä¸å¸¦ç±»åçš„æ ·å¼æ–‡ä»¶ï¼Œç”Ÿæˆæ··åˆåŒ…</li> <li>ç”Ÿæˆå…¨å°ºå¯¸æ ·å¼åŒ…,ç”Ÿæˆvwæ ·å¼åŒ…,å¼€å‘ç¯å¢ƒæ—¶æ‰§è¡Œç©ºä»»åŠ¡</li> <li>å¤åˆ¶å­—ä½“æ–‡ä»¶åˆ°å„ä¸ªæ¸ é“</li> <li>å¤åˆ¶åˆ°libç”Ÿäº§ç›®å½•</li> <li>åˆ é™¤ç”Ÿæˆçš„æ–‡ä»¶ï¼Œæ‰“åŒ…ç»“æŸ</li></ul> <h3 id="code"><a href="#code" class="header-anchor">#</a> code</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// gulpfile</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> series<span class="token punctuation">,</span> src<span class="token punctuation">,</span> dest<span class="token punctuation">,</span> task<span class="token punctuation">,</span> parallel <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'gulp'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> less <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'gulp-less'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> autoprefixer <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'gulp-autoprefixer'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> cssmin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'gulp-cssmin'</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> cssWrap <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@wwh/gulp-css-wrap'</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> merge <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'merge-stream'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> concat <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'gulp-concat'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> replace <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'gulp-replace'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> rimraf <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'rimraf'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> generateExtract <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./less-extract'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> components <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../build/components.json'</span><span class="token punctuation">)</span>
components<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'index'</span><span class="token punctuation">)</span>


<span class="token comment">// åŸºç¡€æ¸ é“æ ·å¼</span>
<span class="token keyword">let</span> channelList <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'app'</span><span class="token punctuation">,</span> <span class="token string">'wechat'</span><span class="token punctuation">,</span> <span class="token string">'qq'</span><span class="token punctuation">]</span>

<span class="token comment">// ç”Ÿæˆextractç›®å½•ï¼ˆåªåŒ…å«å˜é‡åçš„lessæ–‡ä»¶ï¼‰ç”¨äºç”Ÿäº§æ··åˆåŒ…ï¼Œä¼˜åŒ–ä»£ç ä½“ç§¯</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">createExtract</span><span class="token punctuation">(</span><span class="token parameter">done</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  channelList <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'app'</span><span class="token punctuation">,</span> <span class="token string">'wechat'</span><span class="token punctuation">,</span> <span class="token string">'qq'</span><span class="token punctuation">]</span>
  <span class="token keyword">await</span> <span class="token function">generateExtract</span><span class="token punctuation">(</span>components<span class="token punctuation">)</span>
  <span class="token function">done</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// å¤åˆ¶ç›¸åŒæ ·å¼çš„æ¸ é“</span>
<span class="token keyword">function</span> <span class="token function">copySameChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> taskList <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token comment">// å¤åˆ¶appåˆ°touchç»„ä»¶ç›®å½•åŠ å…¥touchç«™</span>
  taskList<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token function">src</span><span class="token punctuation">(</span><span class="token string">'./app/**'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">dest</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">./touch/</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token comment">// å¤åˆ¶qqåˆ°elongç»„ä»¶ç›®å½•åŠ å…¥elongç«™</span>
  taskList<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token function">src</span><span class="token punctuation">(</span><span class="token string">'./qq/**'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">dest</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">./elong/</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  channelList<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'touch'</span><span class="token punctuation">,</span> <span class="token string">'elong'</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token function">merge</span><span class="token punctuation">(</span><span class="token operator">...</span>taskList<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// ç¼–è¯‘å„æ¸ é“åŸºç¡€æ ·å¼</span>
<span class="token keyword">function</span> <span class="token function">compileBase</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> taskList <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> channel <span class="token keyword">of</span> channelList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> channelCompile <span class="token operator">=</span> <span class="token function">src</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">./</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>channel<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/*.less</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">less</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">autoprefixer</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        overrideBrowserslist<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'ie &gt; 9'</span><span class="token punctuation">,</span> <span class="token string">'last 2 versions'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        cascade<span class="token operator">:</span> <span class="token boolean">false</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">cssmin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">dest</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">./</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>channel<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/lib</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    taskList<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>channelCompile<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token function">merge</span><span class="token punctuation">(</span><span class="token operator">...</span>taskList<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// åˆæˆå…¨å°ºå¯¸åŒ…</span>
<span class="token keyword">function</span> <span class="token function">copyFullSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> taskList <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> channel <span class="token keyword">of</span> channelList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> copyPath <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">./</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>channel<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/lib/*.css</span><span class="token template-punctuation string">`</span></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>channel <span class="token operator">==</span> <span class="token string">'hybrid'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      copyPath <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">./hybrid/*.css</span><span class="token template-punctuation string">`</span></span>
    <span class="token punctuation">}</span>
    <span class="token keyword">const</span> channelCompile <span class="token operator">=</span> <span class="token function">src</span><span class="token punctuation">(</span>copyPath<span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">([0-9]+(\.?[0-9]+)?)px</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">match<span class="token punctuation">,</span> p1</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">Number</span><span class="token punctuation">(</span>p1<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token string">'px'</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">dest</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">./fullsize/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>channel<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    taskList<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>channelCompile<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token function">merge</span><span class="token punctuation">(</span><span class="token operator">...</span>taskList<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// åˆæˆvwå•ä½åŒ…</span>
<span class="token keyword">function</span> <span class="token function">copyVWSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> taskList <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> channel <span class="token keyword">of</span> channelList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> copyPath <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">./</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>channel<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/lib/*.css</span><span class="token template-punctuation string">`</span></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>channel <span class="token operator">==</span> <span class="token string">'hybrid'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      copyPath <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">./hybrid/*.css</span><span class="token template-punctuation string">`</span></span>
    <span class="token punctuation">}</span>
    <span class="token keyword">const</span> channelCompile <span class="token operator">=</span> <span class="token function">src</span><span class="token punctuation">(</span>copyPath<span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">([0-9]+(\.?[0-9]+)?)px</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">match<span class="token punctuation">,</span> p1</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> <span class="token function">Number</span><span class="token punctuation">(</span>p1<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">3.75</span> <span class="token operator">+</span> <span class="token string">'vw'</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">dest</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">./vwsize/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>channel<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    taskList<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>channelCompile<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token function">merge</span><span class="token punctuation">(</span><span class="token operator">...</span>taskList<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// å¤åˆ¶å­—ä½“æ–‡ä»¶</span>
<span class="token keyword">function</span> <span class="token function">copyFont</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> taskList <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> channel <span class="token keyword">of</span> channelList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> channelCopy <span class="token operator">=</span> <span class="token function">src</span><span class="token punctuation">(</span><span class="token string">'./default/fonts/**'</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">dest</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">./fullsize/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>channel<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/fonts</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">dest</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">./vwsize/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>channel<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/fonts</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">dest</span><span class="token punctuation">(</span>channel <span class="token operator">===</span> <span class="token string">'hybrid'</span> <span class="token operator">?</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">./</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>channel<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/fonts</span><span class="token template-punctuation string">`</span></span> <span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">./</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>channel<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/lib/fonts</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    taskList<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>channelCopy<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token function">merge</span><span class="token punctuation">(</span><span class="token operator">...</span>taskList<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// å¤åˆ¶åˆ°ç”Ÿäº§ç›®å½•</span>
<span class="token keyword">function</span> <span class="token function">copyToLib</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// åŠ å…¥vwsize,fullsizeæ ·å¼åŒ…</span>
  channelList<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'vwsize'</span><span class="token punctuation">,</span> <span class="token string">'fullsize'</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> taskList <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> channel <span class="token keyword">of</span> channelList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> channelCopy <span class="token operator">=</span> <span class="token function">src</span><span class="token punctuation">(</span>
      <span class="token punctuation">[</span><span class="token string">'hybrid'</span><span class="token punctuation">,</span> <span class="token string">'vwsize'</span><span class="token punctuation">,</span> <span class="token string">'fullsize'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>channel<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">?</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">./</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>channel<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/**</span><span class="token template-punctuation string">`</span></span> <span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">./</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>channel<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/lib/**</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">dest</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">../lib/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>channel<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    taskList<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>channelCopy<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token function">merge</span><span class="token punctuation">(</span><span class="token operator">...</span>taskList<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token function-variable function">trash</span> <span class="token operator">=</span> <span class="token parameter">done</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// åŠ å…¥éœ€è¦åˆ é™¤çš„ä¸€äº›æ–‡ä»¶æ¸ é“</span>
  channelList<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'factory'</span><span class="token punctuation">)</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> channel <span class="token keyword">of</span> channelList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">rimraf</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'app'</span><span class="token punctuation">,</span> <span class="token string">'wechat'</span><span class="token punctuation">,</span> <span class="token string">'qq'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>channel<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">?</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">./</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>channel<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span> <span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">./</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>channel<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/lib/**</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  components<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'loading'</span><span class="token punctuation">,</span> <span class="token string">'icon'</span><span class="token punctuation">,</span> <span class="token string">'base'</span><span class="token punctuation">)</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> channel <span class="token keyword">of</span> <span class="token punctuation">[</span><span class="token string">'app'</span><span class="token punctuation">,</span> <span class="token string">'wechat'</span><span class="token punctuation">,</span> <span class="token string">'qq'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> component <span class="token keyword">of</span> components<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">rimraf</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">./</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>channel<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>component<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.less</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token function">rimraf</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">./</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>channel<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/fonts</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token function">rimraf</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">./</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>channel<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/extract</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">done</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> <span class="token function-variable function">empty</span> <span class="token operator">=</span> <span class="token parameter">done</span> <span class="token operator">=&gt;</span> <span class="token function">done</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token function-variable function">generator</span> <span class="token operator">=</span> <span class="token parameter">type</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">series</span><span class="token punctuation">(</span>
    createExtract<span class="token punctuation">,</span> <span class="token comment">// ç”Ÿæˆextractç›®å½•</span>
    copyLess<span class="token punctuation">,</span> <span class="token comment">// ç”Ÿæˆlessç›®å½•</span>
    type <span class="token operator">==</span> <span class="token string">'build'</span> <span class="token operator">?</span> copySameChannel <span class="token operator">:</span> empty<span class="token punctuation">,</span> <span class="token comment">// å¤åˆ¶ç›¸åŒæ ·å¼çš„æ¸ é“</span>
    compileBase<span class="token punctuation">,</span> <span class="token comment">// ç¼–è¯‘å„æ¸ é“åŸºç¡€æ ·å¼</span>
    compileHybrid<span class="token punctuation">,</span> <span class="token comment">// ç¼–è¯‘å„æ¸ é“åŠ ç±»åæ ·å¼</span>
    connectHybrid<span class="token punctuation">,</span> <span class="token comment">// ç”Ÿæˆæ··åˆåŒ…</span>
    type <span class="token operator">==</span> <span class="token string">'build'</span> <span class="token operator">?</span> <span class="token function">parallel</span><span class="token punctuation">(</span>copyFullSize<span class="token punctuation">,</span> copyVWSize<span class="token punctuation">)</span> <span class="token operator">:</span> empty<span class="token punctuation">,</span> <span class="token comment">// ç”Ÿæˆå…¨å°ºå¯¸æ ·å¼åŒ…</span>
    copyFont<span class="token punctuation">,</span> <span class="token comment">// copyå­—ä½“æ–‡ä»¶</span>
    copyToLib<span class="token punctuation">,</span> <span class="token comment">// å¤åˆ¶åˆ°lib</span>
    trash <span class="token comment">// åˆ é™¤ç”Ÿæˆçš„æ–‡ä»¶</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token function">task</span><span class="token punctuation">(</span><span class="token string">'build'</span><span class="token punctuation">,</span> <span class="token parameter">done</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">generator</span><span class="token punctuation">(</span><span class="token string">'build'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br></div></div><h3 id="æ··åˆæ ·å¼"><a href="#æ··åˆæ ·å¼" class="header-anchor">#</a> æ··åˆæ ·å¼</h3> <p>é€šè¿‡ç±»ååŒºåˆ†å¤šç«™ç‚¹æ ·å¼ï¼Œä½¿ç”¨æ··åˆæ ·å¼ï¼ˆä½“ç§¯è¾ƒå¤§ï¼‰</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token comment">&lt;!-- åœ¨æ ¹èŠ‚ç‚¹åŠ ç±»åï¼Œchannelä¸ºwechatã€appã€elongã€qqã€touchå…¶ä¸­ä¹‹ä¸€ï¼Œä¼šè·å–è¯¥æ¸ é“ç±»åä¸‹çš„æ ·å¼ --&gt;</span>
<span class="token comment">&lt;!-- ä¸åŠ ç±»ååŒºåˆ†åˆ™é»˜è®¤ä¸ºwechatæ ·å¼ --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>app<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>channel<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code> <span class="token comment">//å…¨é‡å¼•å…¥æ··åˆæ ·å¼</span>
 <span class="token keyword">import</span> <span class="token string">'tc-flight-siskin/lib/hybrid/index.css'</span>

 <span class="token comment">//å•ä¸€ç»„ä»¶å¼•å…¥æ··åˆæ ·å¼ç¤ºä¾‹ï¼ˆä»¥buttonä¸ºä¾‹ï¼‰</span>
 <span class="token keyword">import</span> <span class="token string">'tc-flight-siskin/lib/hybrid/button.css'</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="åˆ†æ¸ é“æ ·å¼"><a href="#åˆ†æ¸ é“æ ·å¼" class="header-anchor">#</a> åˆ†æ¸ é“æ ·å¼</h3> <p>é€šè¿‡å¼•å…¥ä¸åŒæ ·å¼å•cssåŒ…åŠ è½½æ ·å¼ï¼Œ</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// æ„å»ºæ—¶å¯é€šè¿‡ç¯å¢ƒå˜é‡åŒºåˆ«æ¸ é“ï¼Œé€šè¿‡åˆ«åå¼•å…¥</span>
<span class="token comment">// npm scriptsï¼Œæ„å»ºè„šæœ¬åŠ ç¯å¢ƒå˜é‡</span>
<span class="token string">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token string">&quot;build:app&quot;</span><span class="token operator">:</span> <span class="token string">&quot;channel=app&quot;</span>
<span class="token punctuation">}</span>

<span class="token comment">// webpack configè®¾ç½®åˆ«å</span>
alias<span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token string">&quot;tc-flight-siskin-theme&quot;</span><span class="token operator">:</span> <span class="token string">&quot;tc-flight-siskin/lib/&quot;</span> <span class="token operator">+</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span>channel<span class="token punctuation">,</span>
  <span class="token comment">// å…¨å°ºå¯¸æ ·å¼è·¯å¾„</span>
  <span class="token string">&quot;tc-flight-siskin-theme&quot;</span><span class="token operator">:</span> <span class="token string">&quot;tc-flight-siskin/lib/fullsize&quot;</span> <span class="token operator">+</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span>channel<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>

<span class="token comment">// å…¨é‡å¼•ç”¨æ ·å¼</span>
<span class="token keyword">import</span> <span class="token string">'tc-flight-siskin-theme/index.css'</span>
<span class="token comment">// å•ä¸ªç»„ä»¶å¼•ç”¨æ ·å¼</span>
<span class="token keyword">import</span> <span class="token string">'tc-flight-siskin-theme/button.css'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">//appæ ·å¼</span>
<span class="token keyword">import</span> <span class="token string">'tc-flight-siskin/lib/app/index.css'</span>
<span class="token comment">//touchç«™æ ·å¼</span>
<span class="token keyword">import</span> <span class="token string">'tc-flight-siskin/lib/touch/index.css'</span>
<span class="token comment">//å¾®ä¿¡æ ·å¼</span>
<span class="token keyword">import</span> <span class="token string">'tc-flight-siskin/lib/wechat/index.css'</span>
<span class="token comment">//è‰ºé¾™æ ·å¼</span>
<span class="token keyword">import</span> <span class="token string">'tc-flight-siskin/lib/elong/index.css'</span>
<span class="token comment">//qqæ ·å¼</span>
<span class="token keyword">import</span> <span class="token string">'tc-flight-siskin/lib/qq/index.css'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="å…¨å°ºå¯¸æ ·å¼"><a href="#å…¨å°ºå¯¸æ ·å¼" class="header-anchor">#</a> å…¨å°ºå¯¸æ ·å¼</h3> <p>åŸºäº<code>750px</code>ï¼Œå…¨é‡å¼•ç”¨æ ·å¼ä¸æ··åˆå¼•ç”¨è§„åˆ™åŒä¸Š</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">//å…¨å°ºå¯¸æ··åˆæ ·å¼</span>
<span class="token keyword">import</span> <span class="token string">'tc-flight-siskin/lib/fullsize/hybrid/index.css'</span>
<span class="token comment">//å…¨å°ºå¯¸appæ ·å¼</span>
<span class="token keyword">import</span> <span class="token string">'tc-flight-siskin/lib/fullsize/app/index.css'</span>
<span class="token comment">//å…¨å°ºå¯¸touchç«™æ ·å¼</span>
<span class="token keyword">import</span> <span class="token string">'tc-flight-siskin/lib/fullsize/touch/index.css'</span>
<span class="token comment">//å…¨å°ºå¯¸å¾®ä¿¡æ ·å¼</span>
<span class="token keyword">import</span> <span class="token string">'tc-flight-siskin/lib/fullsize/wechat/index.css'</span>
<span class="token comment">//å…¨å°ºå¯¸è‰ºé¾™æ ·å¼</span>
<span class="token keyword">import</span> <span class="token string">'tc-flight-siskin/lib/fullsize/elong/index.css'</span>
<span class="token comment">//å…¨å°ºå¯¸qqæ ·å¼</span>
<span class="token keyword">import</span> <span class="token string">'tc-flight-siskin/lib/fullsize/qq/index.css'</span>

<span class="token comment">// å•ä¸ªç»„ä»¶å¼•ç”¨æ ·å¼(appæ¸ é“çš„buttonç¤ºä¾‹)</span>
<span class="token keyword">import</span> <span class="token string">'tc-flight-siskin/lib/fullsize/app/button.css'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h3 id="vwæ ·å¼"><a href="#vwæ ·å¼" class="header-anchor">#</a> VWæ ·å¼</h3> <p>åŸºäº<code>375px</code>ï¼Œå…¨é‡å¼•ç”¨æ ·å¼ä¸æ··åˆå¼•ç”¨è§„åˆ™åŒä¸Š</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">//VWåŒ…æ··åˆæ ·å¼</span>
<span class="token keyword">import</span> <span class="token string">'tc-flight-siskin/lib/vwsize/hybrid/index.css'</span>
<span class="token comment">//VWåŒ…appæ ·å¼</span>
<span class="token keyword">import</span> <span class="token string">'tc-flight-siskin/lib/vwsize/app/index.css'</span>
<span class="token comment">//VWåŒ…touchç«™æ ·å¼</span>
<span class="token keyword">import</span> <span class="token string">'tc-flight-siskin/lib/vwsize/touch/index.css'</span>
<span class="token comment">//VWåŒ…å¾®ä¿¡æ ·å¼</span>
<span class="token keyword">import</span> <span class="token string">'tc-flight-siskin/lib/vwsize/wechat/index.css'</span>
<span class="token comment">//VWåŒ…è‰ºé¾™æ ·å¼</span>
<span class="token keyword">import</span> <span class="token string">'tc-flight-siskin/lib/vwsize/elong/index.css'</span>
<span class="token comment">//VWåŒ…qqæ ·å¼</span>
<span class="token keyword">import</span> <span class="token string">'tc-flight-siskin/lib/vwsize/qq/index.css'</span>

<span class="token comment">// å•ä¸ªç»„ä»¶å¼•ç”¨æ ·å¼(appæ¸ é“çš„buttonç¤ºä¾‹)</span>
<span class="token keyword">import</span> <span class="token string">'tc-flight-siskin/lib/vwsize/app/button.css'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h2 id="gulpæ’ä»¶"><a href="#gulpæ’ä»¶" class="header-anchor">#</a> gulpæ’ä»¶</h2> <p>pipe æ„å‘³ç®¡é“ï¼Œå¾ˆå¥½ç†è§£ï¼Œæ–‡ä»¶æµé€šè¿‡ pipe ç®¡é“ï¼Œé‚£ä¹ˆå°±å¯ä»¥åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­å¯¹æ–‡ä»¶æµè¿›è¡Œæ“ä½œï¼Œå®šåˆ¶è‡ªå·±çš„éœ€æ±‚ã€‚æ‰€æœ‰çš„å¤„ç†éƒ½æ˜¯åœ¨ pipe ä¸­è¿›è¡Œçš„ã€‚åœ¨ç»„ä»¶åº“æ ·å¼åŒ…çš„å¤„ç†ä¸­ï¼Œæˆ‘ä»¬ä¹Ÿå®ç°äº†ä¸€ä¸ª<code>gulp</code>æ’ä»¶,ç”¨æ¥ç»™æ··åˆåŒ…åŠ ä¸Šå¯¹åº”æ¸ é“çš„<code>class</code>ç±»å.</p> <h3 id="ç¬¬ä¸€æ­¥-æ’ä»¶å®šä¹‰"><a href="#ç¬¬ä¸€æ­¥-æ’ä»¶å®šä¹‰" class="header-anchor">#</a> ç¬¬ä¸€æ­¥ï¼šæ’ä»¶å®šä¹‰</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> PluginError <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'plugin-error'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// é”™è¯¯å¤„ç†</span>
<span class="token keyword">const</span> through <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'through2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// æµå¤„ç†åŒ…ï¼Œæ•´ä¸ªgulpæµçš„å¤„ç†</span>
<span class="token keyword">const</span> cssWrap <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./cssWrap'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ä¸šåŠ¡å¤„ç†å·¥ç¨‹</span>

<span class="token keyword">const</span> <span class="token constant">PLUGIN_NAME</span> <span class="token operator">=</span> <span class="token string">'gulp-css-wrap'</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">options <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">function</span> <span class="token function">transform</span><span class="token punctuation">(</span><span class="token parameter">file<span class="token punctuation">,</span> encoding<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>file<span class="token punctuation">.</span><span class="token function">isNull</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> file<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>file<span class="token punctuation">.</span><span class="token function">isStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">PluginError</span><span class="token punctuation">(</span><span class="token constant">PLUGIN_NAME</span><span class="token punctuation">,</span> <span class="token string">'Streaming not supported'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// æ‰§è¡Œä¸šåŠ¡</span>
    file<span class="token punctuation">.</span>contents <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token function">cssWrap</span><span class="token punctuation">(</span>file<span class="token punctuation">.</span>contents<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> options<span class="token punctuation">,</span> file<span class="token punctuation">.</span>path<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> file<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> through<span class="token punctuation">.</span><span class="token function">obj</span><span class="token punctuation">(</span>transform<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><h3 id="ç¬¬äºŒæ­¥"><a href="#ç¬¬äºŒæ­¥" class="header-anchor">#</a> ç¬¬äºŒæ­¥</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs-extra'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> deepmerge <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'deepmerge'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> cssParse <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'css-parse'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> cssStringify <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'css-stringify'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> chalk <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'chalk'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> log <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fancy-log'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">processRules</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">list<span class="token punctuation">,</span> options</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> list<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">r</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>r<span class="token punctuation">.</span>selectors<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    r<span class="token punctuation">.</span>selectors<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">s<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>options<span class="token punctuation">.</span>skip <span class="token operator">&amp;&amp;</span> options<span class="token punctuation">.</span>skip<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
      <span class="token keyword">let</span> selector <span class="token operator">=</span> options<span class="token punctuation">.</span>selector
      <span class="token comment">// å…³é”®ä»£ç ï¼Œå°†ç±»åè¿›å»å‰ç¼€æ‹¼æ¥</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> selector <span class="token operator">===</span> <span class="token string">'string'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        selector <span class="token operator">=</span> options<span class="token punctuation">.</span>selector <span class="token operator">?</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>options<span class="token punctuation">.</span>selector<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>s<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span> <span class="token operator">:</span> s<span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        options<span class="token punctuation">.</span>selector<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">e</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          arr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>e<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>s<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        selector <span class="token operator">=</span> arr<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">', '</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      r<span class="token punctuation">.</span>selectors<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">=</span> selector<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>r<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">'media'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    r<span class="token punctuation">.</span>rules <span class="token operator">=</span> <span class="token function">processRules</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>rules<span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> r<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> cssWrap <span class="token operator">=</span> <span class="token punctuation">(</span>string<span class="token punctuation">,</span> options <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> filePath <span class="token operator">=</span> <span class="token string">' '</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// åˆå§‹åŒ–å‚æ•°</span>
  <span class="token keyword">const</span> _options <span class="token operator">=</span> <span class="token function">deepmerge</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    selector<span class="token operator">:</span> <span class="token string">'.css-wrap'</span><span class="token punctuation">,</span>
    skip<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
    log<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// è¯»å–æ–‡ä»¶</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>fs<span class="token punctuation">.</span><span class="token function">existsSync</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      string <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>log<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> fileName <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">basename</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>chalk<span class="token punctuation">.</span><span class="token function">yellow</span><span class="token punctuation">(</span><span class="token string">'css-wrap: skipping empty file -&gt;'</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>fileName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">\n</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> <span class="token string">''</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// è§£æcss</span>
  <span class="token keyword">const</span> css <span class="token operator">=</span> <span class="token function">cssParse</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// å¤„ç†css</span>
  css<span class="token punctuation">.</span>stylesheet<span class="token punctuation">.</span>rules <span class="token operator">=</span> <span class="token function">processRules</span><span class="token punctuation">(</span>css<span class="token punctuation">.</span>stylesheet<span class="token punctuation">.</span>rules<span class="token punctuation">,</span> _options<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// åºåˆ—åŒ–cssç„¶åè¿”å›</span>
  <span class="token keyword">return</span> <span class="token function">cssStringify</span><span class="token punctuation">(</span>css<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>


module<span class="token punctuation">.</span>exports <span class="token operator">=</span> cssWrap<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br></div></div><ul><li>cssParse è§£æcss</li></ul> <p><img src="https://gitee.com/PENG_YUE/myImg/raw/master/uPic/wph1Jq.png" alt="img"></p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      â†
      <a href="/my-blog/conclusion/engineering/siskinImport.html" class="prev">
        ç»„ä»¶åº“ä¹‹æŒ‰éœ€åŠ è½½
      </a></span> <span class="next"><a href="/my-blog/conclusion/engineering/unitTest.html">
        ç»„ä»¶å•å…ƒæµ‹è¯•
      </a>
      â†’
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/my-blog/assets/js/app.2604ea65.js" defer></script><script src="/my-blog/assets/js/2.df0a347f.js" defer></script><script src="/my-blog/assets/js/40.d08bd8a6.js" defer></script>
  </body>
</html>
