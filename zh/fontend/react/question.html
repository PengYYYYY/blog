<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>React常见问题 | Super-YUE Blog</title>
    <meta name="generator" content="VuePress 1.5.2">
    
    <meta name="description" content="日常学习和技术积累">
    <link rel="preload" href="/my-blog/assets/css/0.styles.a70fa01a.css" as="style"><link rel="preload" href="/my-blog/assets/js/app.e4445ed3.js" as="script"><link rel="preload" href="/my-blog/assets/js/2.c20646db.js" as="script"><link rel="preload" href="/my-blog/assets/js/100.c40de34d.js" as="script"><link rel="prefetch" href="/my-blog/assets/js/10.d6bb196d.js"><link rel="prefetch" href="/my-blog/assets/js/101.462c46e4.js"><link rel="prefetch" href="/my-blog/assets/js/102.ec448440.js"><link rel="prefetch" href="/my-blog/assets/js/103.1ff0afb3.js"><link rel="prefetch" href="/my-blog/assets/js/104.8b4274e9.js"><link rel="prefetch" href="/my-blog/assets/js/105.e04ad651.js"><link rel="prefetch" href="/my-blog/assets/js/106.71dae98d.js"><link rel="prefetch" href="/my-blog/assets/js/107.164479f6.js"><link rel="prefetch" href="/my-blog/assets/js/108.aa780eeb.js"><link rel="prefetch" href="/my-blog/assets/js/109.2c8309b7.js"><link rel="prefetch" href="/my-blog/assets/js/11.bcac392a.js"><link rel="prefetch" href="/my-blog/assets/js/110.f391d215.js"><link rel="prefetch" href="/my-blog/assets/js/111.93687b2f.js"><link rel="prefetch" href="/my-blog/assets/js/112.1133e467.js"><link rel="prefetch" href="/my-blog/assets/js/113.6d81fef4.js"><link rel="prefetch" href="/my-blog/assets/js/114.9ae7f8ee.js"><link rel="prefetch" href="/my-blog/assets/js/115.3915ad48.js"><link rel="prefetch" href="/my-blog/assets/js/116.b9e735ec.js"><link rel="prefetch" href="/my-blog/assets/js/117.ffd0dc9f.js"><link rel="prefetch" href="/my-blog/assets/js/118.c55e446a.js"><link rel="prefetch" href="/my-blog/assets/js/119.c41c3afd.js"><link rel="prefetch" href="/my-blog/assets/js/12.3325a6f5.js"><link rel="prefetch" href="/my-blog/assets/js/120.75436432.js"><link rel="prefetch" href="/my-blog/assets/js/121.9588c290.js"><link rel="prefetch" href="/my-blog/assets/js/13.63bfd8b0.js"><link rel="prefetch" href="/my-blog/assets/js/14.2a630bb1.js"><link rel="prefetch" href="/my-blog/assets/js/15.c22e87ab.js"><link rel="prefetch" href="/my-blog/assets/js/16.5da201a4.js"><link rel="prefetch" href="/my-blog/assets/js/17.e571b3d5.js"><link rel="prefetch" href="/my-blog/assets/js/18.0066d657.js"><link rel="prefetch" href="/my-blog/assets/js/19.7f50df0d.js"><link rel="prefetch" href="/my-blog/assets/js/20.a16bea81.js"><link rel="prefetch" href="/my-blog/assets/js/21.ee769342.js"><link rel="prefetch" href="/my-blog/assets/js/22.d2826357.js"><link rel="prefetch" href="/my-blog/assets/js/23.997a8d8c.js"><link rel="prefetch" href="/my-blog/assets/js/24.5b02db42.js"><link rel="prefetch" href="/my-blog/assets/js/25.517bb80b.js"><link rel="prefetch" href="/my-blog/assets/js/26.d276694b.js"><link rel="prefetch" href="/my-blog/assets/js/27.1d7e2b13.js"><link rel="prefetch" href="/my-blog/assets/js/28.fa82aa3d.js"><link rel="prefetch" href="/my-blog/assets/js/29.52e2a47a.js"><link rel="prefetch" href="/my-blog/assets/js/3.aad7c563.js"><link rel="prefetch" href="/my-blog/assets/js/30.fe94342e.js"><link rel="prefetch" href="/my-blog/assets/js/31.67ed4032.js"><link rel="prefetch" href="/my-blog/assets/js/32.eaeadd20.js"><link rel="prefetch" href="/my-blog/assets/js/33.963b2da3.js"><link rel="prefetch" href="/my-blog/assets/js/34.b07b3158.js"><link rel="prefetch" href="/my-blog/assets/js/35.fd6427db.js"><link rel="prefetch" href="/my-blog/assets/js/36.b3227fe1.js"><link rel="prefetch" href="/my-blog/assets/js/37.cccee5eb.js"><link rel="prefetch" href="/my-blog/assets/js/38.1fc66e50.js"><link rel="prefetch" href="/my-blog/assets/js/39.a9ed0354.js"><link rel="prefetch" href="/my-blog/assets/js/4.9bf11b2d.js"><link rel="prefetch" href="/my-blog/assets/js/40.d54daaab.js"><link rel="prefetch" href="/my-blog/assets/js/41.8a4dae21.js"><link rel="prefetch" href="/my-blog/assets/js/42.8fd34b96.js"><link rel="prefetch" href="/my-blog/assets/js/43.0c3147b0.js"><link rel="prefetch" href="/my-blog/assets/js/44.a0ad974f.js"><link rel="prefetch" href="/my-blog/assets/js/45.72030a21.js"><link rel="prefetch" href="/my-blog/assets/js/46.7adc71c7.js"><link rel="prefetch" href="/my-blog/assets/js/47.ead80f5a.js"><link rel="prefetch" href="/my-blog/assets/js/48.1bc63854.js"><link rel="prefetch" href="/my-blog/assets/js/49.af27f080.js"><link rel="prefetch" href="/my-blog/assets/js/5.83e5464d.js"><link rel="prefetch" href="/my-blog/assets/js/50.2a22eee4.js"><link rel="prefetch" href="/my-blog/assets/js/51.68eeb764.js"><link rel="prefetch" href="/my-blog/assets/js/52.bb00bcbd.js"><link rel="prefetch" href="/my-blog/assets/js/53.161e6e55.js"><link rel="prefetch" href="/my-blog/assets/js/54.84607384.js"><link rel="prefetch" href="/my-blog/assets/js/55.3afd782a.js"><link rel="prefetch" href="/my-blog/assets/js/56.6aac78bc.js"><link rel="prefetch" href="/my-blog/assets/js/57.d014ef3d.js"><link rel="prefetch" href="/my-blog/assets/js/58.fc02f91d.js"><link rel="prefetch" href="/my-blog/assets/js/59.7396389f.js"><link rel="prefetch" href="/my-blog/assets/js/6.73f54bd9.js"><link rel="prefetch" href="/my-blog/assets/js/60.fa51404d.js"><link rel="prefetch" href="/my-blog/assets/js/61.47fdd43d.js"><link rel="prefetch" href="/my-blog/assets/js/62.cc21753b.js"><link rel="prefetch" href="/my-blog/assets/js/63.f0673707.js"><link rel="prefetch" href="/my-blog/assets/js/64.f010bd9d.js"><link rel="prefetch" href="/my-blog/assets/js/65.36f9bc34.js"><link rel="prefetch" href="/my-blog/assets/js/66.f5d7507f.js"><link rel="prefetch" href="/my-blog/assets/js/67.e6d3d3eb.js"><link rel="prefetch" href="/my-blog/assets/js/68.d847b6e7.js"><link rel="prefetch" href="/my-blog/assets/js/69.1a9cd87b.js"><link rel="prefetch" href="/my-blog/assets/js/7.7016aa5b.js"><link rel="prefetch" href="/my-blog/assets/js/70.d2d055b7.js"><link rel="prefetch" href="/my-blog/assets/js/71.d3966f9d.js"><link rel="prefetch" href="/my-blog/assets/js/72.694c4646.js"><link rel="prefetch" href="/my-blog/assets/js/73.18e53735.js"><link rel="prefetch" href="/my-blog/assets/js/74.1e0f06d6.js"><link rel="prefetch" href="/my-blog/assets/js/75.0ab26173.js"><link rel="prefetch" href="/my-blog/assets/js/76.de066a90.js"><link rel="prefetch" href="/my-blog/assets/js/77.1528f02b.js"><link rel="prefetch" href="/my-blog/assets/js/78.3526c0df.js"><link rel="prefetch" href="/my-blog/assets/js/79.b1acc35a.js"><link rel="prefetch" href="/my-blog/assets/js/8.b5a94928.js"><link rel="prefetch" href="/my-blog/assets/js/80.d4bafadd.js"><link rel="prefetch" href="/my-blog/assets/js/81.7dee75f0.js"><link rel="prefetch" href="/my-blog/assets/js/82.8c50245d.js"><link rel="prefetch" href="/my-blog/assets/js/83.7ba47bb5.js"><link rel="prefetch" href="/my-blog/assets/js/84.38c03ce3.js"><link rel="prefetch" href="/my-blog/assets/js/85.9baeef25.js"><link rel="prefetch" href="/my-blog/assets/js/86.4c1943f8.js"><link rel="prefetch" href="/my-blog/assets/js/87.be7120fa.js"><link rel="prefetch" href="/my-blog/assets/js/88.83b7c4c2.js"><link rel="prefetch" href="/my-blog/assets/js/89.cf659594.js"><link rel="prefetch" href="/my-blog/assets/js/9.af8f13b6.js"><link rel="prefetch" href="/my-blog/assets/js/90.3606ac44.js"><link rel="prefetch" href="/my-blog/assets/js/91.472e9b6e.js"><link rel="prefetch" href="/my-blog/assets/js/92.dd1eab7f.js"><link rel="prefetch" href="/my-blog/assets/js/93.9abefeb2.js"><link rel="prefetch" href="/my-blog/assets/js/94.4773c33b.js"><link rel="prefetch" href="/my-blog/assets/js/95.9b876f91.js"><link rel="prefetch" href="/my-blog/assets/js/96.f8a8ac5a.js"><link rel="prefetch" href="/my-blog/assets/js/97.263b6640.js"><link rel="prefetch" href="/my-blog/assets/js/98.813ad252.js"><link rel="prefetch" href="/my-blog/assets/js/99.d0012783.js">
    <link rel="stylesheet" href="/my-blog/assets/css/0.styles.a70fa01a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/my-blog/" class="home-link router-link-active"><!----> <span class="site-name">Super-YUE Blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/my-blog/zh/fontend/" class="nav-link router-link-active">
  前端
</a></div><div class="nav-item"><a href="/my-blog/zh/algorithm/" class="nav-link">
  算法
</a></div><div class="nav-item"><a href="/my-blog/zh/backend/" class="nav-link">
  后端
</a></div><div class="nav-item"><a href="/my-blog/zh/network/" class="nav-link">
  网络
</a></div><div class="nav-item"><a href="/my-blog/zh/conclusion/" class="nav-link">
  总结
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/my-blog/zh/fontend/" class="nav-link router-link-active">
  前端
</a></div><div class="nav-item"><a href="/my-blog/zh/algorithm/" class="nav-link">
  算法
</a></div><div class="nav-item"><a href="/my-blog/zh/backend/" class="nav-link">
  后端
</a></div><div class="nav-item"><a href="/my-blog/zh/network/" class="nav-link">
  网络
</a></div><div class="nav-item"><a href="/my-blog/zh/conclusion/" class="nav-link">
  总结
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>vue</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>react</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/my-blog/zh/fontend/react/core.html" class="sidebar-link">React核心</a></li><li><a href="/my-blog/zh/fontend/react/redux.html" class="sidebar-link">Redux</a></li><li><a href="/my-blog/zh/fontend/react/router.html" class="sidebar-link">React-router</a></li><li><a href="/my-blog/zh/fontend/react/question.html" aria-current="page" class="active sidebar-link">React常见问题</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/my-blog/zh/fontend/react/question.html#生命周期相关" class="sidebar-link">生命周期相关</a></li><li class="sidebar-sub-header"><a href="/my-blog/zh/fontend/react/question.html#渲染相关" class="sidebar-link">渲染相关</a></li><li class="sidebar-sub-header"><a href="/my-blog/zh/fontend/react/question.html#开放性问题" class="sidebar-link">开放性问题</a></li><li class="sidebar-sub-header"><a href="/my-blog/zh/fontend/react/question.html#常见组件优化技术" class="sidebar-link">常见组件优化技术</a></li><li class="sidebar-sub-header"><a href="/my-blog/zh/fontend/react/question.html#重点api" class="sidebar-link">重点API</a></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>框架对比</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Javascript</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>工程化</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>性能优化</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>浏览器</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>HTML &amp;&amp; CSS</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="react常见问题"><a href="#react常见问题" class="header-anchor">#</a> React常见问题</h1> <h2 id="生命周期相关"><a href="#生命周期相关" class="header-anchor">#</a> 生命周期相关</h2> <h3 id="挂载阶段"><a href="#挂载阶段" class="header-anchor">#</a> 挂载阶段</h3> <p>挂载阶段也可以理解为初始化阶段，也就是把我们的组件插入到 DOM 中。</p> <ul><li>constructor</li> <li>getDerivedStateFromProps</li> <li><s>UNSAFE_componentWillMount</s></li> <li>render</li> <li>(React Updates DOM and refs)</li> <li>componentDidMount</li></ul> <h4 id="constructor"><a href="#constructor" class="header-anchor">#</a> constructor</h4> <p>组件的构造函数，第一个被执行。显式定义构造函数时，需要在第一行执行 <code>super(props)</code>，否则不能再构造函数中拿到 <code>this</code>。</p> <p>在构造函数中，我们一般会做两件事：</p> <ul><li>初始化 state</li> <li>对自定义方法进行 this 绑定</li></ul> <h4 id="getderivedstatefromprops"><a href="#getderivedstatefromprops" class="header-anchor">#</a> getDerivedStateFromProps</h4> <p>是一个静态函数，所以不能在这里使用 this，也表明了 React 官方不希望调用方滥用这个生命周期函数。每当父组件引发当前组件的渲染过程时，getDerivedStateFromProps 都会被调用，这样我们有机会根据新的 props 和当前的 state 来调整一个新的 state。</p> <p>这个函数会在收到新的 props，调用了 setState 或 forceUpdate 时被调用。</p> <h4 id="render"><a href="#render" class="header-anchor">#</a> render</h4> <p>React 最核心的方法，class 组件中必须实现的方法。</p> <p>当 render 被调用时，它会检查 <code>this.props</code> 和 <code>this.state</code> 的变化并返回一下类型之一：</p> <ul><li>原生的 DOM，如 div</li> <li>React 组件</li> <li>数组或 Fragment</li> <li>Portals（传送门）</li> <li>字符串或数字，被渲染成文本节点</li> <li>布尔值或 null，不会渲染任何东西</li></ul> <h4 id="componentdidmount"><a href="#componentdidmount" class="header-anchor">#</a> componentDidMount</h4> <p>在组件挂载之后立即调用。依赖于 DOM 节点的初始化应该放在这里。如需通过网络请求获取数据，此处是实例化请求的好地方。这个方法比较适合添加订阅的地方，如果添加了订阅，请记得在卸载的时候取消订阅。</p> <p>你可以在 componentDidMount 里面直接调用 setState，它将触发额外渲染，但此渲染会发生在浏览器更新屏幕之前，如此保证了即使 render 了两次，用户也不会看到中间状态。</p> <h3 id="更新阶段"><a href="#更新阶段" class="header-anchor">#</a> 更新阶段</h3> <p>更新阶段是指当组件的 props 发生了改变，或者组件内部调用了 setState 或者发生了 forceUpdate，这个阶段的过程包括：</p> <ul><li>UNSAFE_componentWillReceiveProps</li> <li>getDerivedStateFromProps</li> <li>sholdComponentUpdate</li> <li>UNSAFE_componentWIllUpdate</li> <li>render</li> <li>getSnapshotBeforeUpdate</li> <li>(React Updates DOM and refs)</li> <li>componentDidUpdate</li></ul> <h4 id="shouldcomponentupdate"><a href="#shouldcomponentupdate" class="header-anchor">#</a> shouldComponentUpdate</h4> <p>它有两个参数，根据此函数的返回值来判断是否重新进行渲染，首次渲染或者是当我们调用了 forceUpdate 时并不会触发此方法，此方法仅用于性能优化。</p> <p>但是官方提倡我们使用内置的 PureComponent 而不是自己编写 shouldComponentUpdate。</p> <h4 id="getsnapshotbeforeupdate"><a href="#getsnapshotbeforeupdate" class="header-anchor">#</a> getSnapshotBeforeUpdate</h4> <p>这个生命周期函数发生在 render 之后，在更新之前，给了一个机会去获取 DOM 信息，计算得到并返回一个 snapshot，这个 snapshot 会作为 componentDidUpdate 第三个参数传入。</p> <h4 id="componentdidupdate"><a href="#componentdidupdate" class="header-anchor">#</a> componentDidUpdate</h4> <p>这个函数会在更新后被立即调用，首次渲染不会执行此方法。在这个函数中我们可以操作 DOM，可以发起请求，还可以 setState，但注意一定要用条件语句，否则会导致无限循环。</p> <h3 id="卸载阶段"><a href="#卸载阶段" class="header-anchor">#</a> 卸载阶段</h3> <h4 id="componentwillunmount"><a href="#componentwillunmount" class="header-anchor">#</a> componentWillUnmount</h4> <p>这个生命周期函数会在组件卸载销毁之前被调用，我们可以在这里执行一些清除操作。不要在这里调用 setState，因为组件不会重新渲染。</p> <h3 id="shouldcomponentupdate-的作用"><a href="#shouldcomponentupdate-的作用" class="header-anchor">#</a> shouldComponentUpdate 的作用</h3> <p>shouldComponentUpdate 这个方法用来判断是否需要调用 render 方法重新描绘 DOM。因为 DOM 的描绘性能开销很大，如果可以在这个生命周期阶段做出更优化的 DOM diff 算法，可以极大地提升性能。</p> <h2 id="渲染相关"><a href="#渲染相关" class="header-anchor">#</a> 渲染相关</h2> <h3 id="reactdiff"><a href="#reactdiff" class="header-anchor">#</a> ReactDiff</h3> <p>由于 diff 操作本身会带来性能上的损耗，在 React 文档中提到过，即使最先进的算法中，将前后两棵树完全比对的算法复杂度为<code>O(n3)</code>，其中 n 为树中元素的数量。如果 React 使用了该算法，那么仅仅一千个元素的页面所需要执行的计算量就是十亿的量级，这无疑是无法接受的。为了降低算法的复杂度，React 的 diff 会预设三个限制：</p> <ol><li>只对同级元素进行 diff 比对。如果一个元素节点在前后两次更新中跨越了层级，那么 React 不会尝试复用它</li> <li>两个不同类型的元素会产生出不同的树。如果元素由 div 变成 p，React 会销毁 div 及其子孙节点，并新建 p 及其子孙节点</li> <li>开发者可以通过 key 来暗示哪些子元素在不同的渲染下能保持稳定</li></ol> <h3 id="react中的key的作用"><a href="#react中的key的作用" class="header-anchor">#</a> React中的key的作用</h3> <ol><li>和type值一起来标记同级节点，当前元素的唯一性。</li> <li>fiber架构的唯一性</li></ol> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token comment">&lt;!-- 更新前 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>ka<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>ka<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h3</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>song<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>song<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>he</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>

<span class="token comment">&lt;!-- 更新后 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h3</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>song<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>song<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h3</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>ka<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>ka<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>如果没有 key，React 会认为 div 的第一个子节点由 p 变成 h3，第二个子节点由 h3 变成 p，则会销毁这两个节点并重新构造。但是当我们用 key 指明了节点前后对应关系后，React 知道 <code>key === &quot;ka&quot;</code> 的 p 更新后还在，所以可以复用该节点，只需要交换顺序。key 是 React 用来追踪哪些列表元素被修改、被添加或者被移除的辅助标志。</p> <p>在开发过程中，我们需要保证某个元素的 key 在其同级元素中具有唯一性。在 React diff 算法中，React 会借助元素的 Key 值来判断该元素是新近创建的还是被移动而来的元素，从而减少不必要的元素重新渲染。同时，React 还需要借助 key 来判断元素与本地状态的关联关系。</p> <h3 id="react-fiber"><a href="#react-fiber" class="header-anchor">#</a> React Fiber</h3> <ul><li>对于⼤大型项⽬目，组件树会很⼤大，这个时候递归遍历的成本就会很⾼高，会造成主线程被持续占⽤用，结果就是主线程上的布局、动画等周期性任务就⽆无法⽴立即得到处理理，造成视觉上的卡顿，影响⽤用户体验。</li> <li>增量渲染(把渲染任务拆分成块，匀到多帧)</li> <li>更新时能够暂停，终⽌，复⽤渲染任务</li> <li>给不同类型的更新赋予优先级</li> <li>并发⽅面新的基础能⼒</li></ul> <h3 id="调用-setstate-之后发生了什么"><a href="#调用-setstate-之后发生了什么" class="header-anchor">#</a> 调用 setState 之后发生了什么</h3> <blockquote><p>状态合并</p></blockquote> <p>在代码中调用 setState 函数之后，React 会将传入的参数与之前的状态进行合并，然后触发所谓的调和过程（Reconciliation）。</p> <blockquote><p>调和</p></blockquote> <p>经过调和过程，React 会以相对高效的方式根据新的状态构建 React 元素树并且着手重新渲染整个 UI 界面。在 React 得到元素树之后，React 会计算出新的树和老的树之间的差异，然后根据差异对界面进行最小化重新渲染。通过 diff 算法，React 能够精确制导哪些位置发生了改变以及应该如何改变，这就保证了按需更新，而不是全部重新渲染。</p> <h3 id="setstate是同步还是异步"><a href="#setstate是同步还是异步" class="header-anchor">#</a> setState是同步还是异步</h3> <p>合成事件是批量异步执行的</p> <p>原生事件是同步执行的</p> <h2 id="开放性问题"><a href="#开放性问题" class="header-anchor">#</a> 开放性问题</h2> <h3 id="虚拟dom"><a href="#虚拟dom" class="header-anchor">#</a> 虚拟dom</h3> <h4 id="为什么要使用虚拟dom对象"><a href="#为什么要使用虚拟dom对象" class="header-anchor">#</a> 为什么要使用虚拟dom对象</h4> <p>DOM操作很慢，轻微的操作都可能导致页面重新排版，非常耗性能。相对于DOM对象，js对象 处理起来更快，而且更简单。通过diff算法对比新旧vdom之间的差异，可以批量的、最小化的执行 dom操作，从而提高性能。</p> <p>在获取原生的dom节点后，dom节点的属性极多，diff后的成本较高。在使用虚拟dom后，只需要对我们用到的属性做diff即可。</p> <h4 id="dom的使用"><a href="#dom的使用" class="header-anchor">#</a> dom的使用</h4> <p>React中用JSX语法描述视图，通过babel-loader转译后它们变为React.createElement(...)形 式，该函数将生成vdom来描述真实dom。将来如果状态变化，vdom将作出相应变化，再通过diff算法，对比新老vdom区别从而做出最终dom操作。</p> <h4 id="jsx"><a href="#jsx" class="header-anchor">#</a> jsx</h4> <p>React 使用 JSX 来替代常规的 JavaScript。JSX 是一个看起来很像 XML 的 JavaScript 语法扩展。使用 JSX 编写模板简单快速。JSX编译为 JavaScript 代码后进行了优化，执行更快。</p> <h2 id="常见组件优化技术"><a href="#常见组件优化技术" class="header-anchor">#</a> 常见组件优化技术</h2> <h3 id="使用shouldcomponentupdate"><a href="#使用shouldcomponentupdate" class="header-anchor">#</a> 使用shouldComponentUpdate</h3> <p>通过对比新老参数，来达到优化效果</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">shouldComponentUpdate</span><span class="token punctuation">(</span><span class="token parameter">nextProps<span class="token punctuation">,</span> nextState</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> xxx <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props
  <span class="token keyword">const</span> <span class="token punctuation">{</span> xxx<span class="token operator">:</span> oldXxx <span class="token punctuation">}</span> <span class="token operator">=</span> nextProps
  <span class="token keyword">if</span><span class="token punctuation">(</span>xxx <span class="token operator">==</span> oldXxx<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">false</span>
  <span class="token keyword">return</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="purecomponentupdate"><a href="#purecomponentupdate" class="header-anchor">#</a> pureComponentUpdate</h3> <p>内部执行了一个shouldComponentUpdate，进行了一个前后值的浅比较。但是只能用作类组件。</p> <p>React.Component 和 React.PureComponent很相似，两则的区别在于，PureComponent类帮我们以浅比较的方式对比props和state，实现了shouldComponentUpdate()函数，在某些情况下，使用PureComponent可以减少render函数的执行，提升性能。</p> <p>PureComponent默认实现的shouldComponentUpdate()方法使用的是浅比较： 即值的比较或引用的比较, 不会进行深层次的对比，所以当props或state的值是引用类型时，即使对象的值改变了，但是对象的引用没变</p> <p>PureComponent也会影响子组件</p> <h3 id="react-memo"><a href="#react-memo" class="header-anchor">#</a> React.memo</h3> <p>在函数组件中，原理是进行props比较</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> MemoComponent <span class="token operator">=</span> <span class="token function">memo</span><span class="token punctuation">(</span>
  <span class="token parameter">props</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span><span class="token number">123</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">(</span><span class="token parameter">prevProps<span class="token punctuation">,</span> nextProps</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> preveProps<span class="token punctuation">.</span>xxx <span class="token operator">===</span> nextProps<span class="token punctuation">.</span>xxx
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="usememo"><a href="#usememo" class="header-anchor">#</a> useMemo</h3> <p>原理也是进行第二个依赖参数的比较，类似于vue中的computed</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> xxx <span class="token operator">=</span> <span class="token function">useMemo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> props <span class="token operator">*</span> <span class="token number">2</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>props<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="usecallback"><a href="#usecallback" class="header-anchor">#</a> useCallback</h3> <p>函数版本的useMemo,依赖项的对比。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> xxFn <span class="token operator">=</span> <span class="token function">useCallback</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>propx<span class="token punctuation">]</span><span class="token punctuation">)</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="重点api"><a href="#重点api" class="header-anchor">#</a> 重点API</h2> <h3 id="react-中-ref-的作用"><a href="#react-中-ref-的作用" class="header-anchor">#</a> React 中 ref 的作用</h3> <p>ref 是 React 提供的一种可以安全访问 DOM 元素或者某个组件实例的方式。</p> <p>在类组件中使用 <code>createRef()</code>，在函数组件中使用 <code>useRef</code>或者 <code>forwardRef</code>。</p> <p>使用类型</p> <ul><li>createRef</li> <li>forwardRef</li> <li>useRef</li></ul> <h3 id="cloneelement"><a href="#cloneelement" class="header-anchor">#</a> cloneElement</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">ProcessInput</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> React<span class="token punctuation">.</span><span class="token function">cloneElement</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>input <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  placeholder<span class="token operator">:</span> <span class="token string">'xxxx'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>原理</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">cloneElement</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">element<span class="token punctuation">,</span> config<span class="token punctuation">,</span> <span class="token operator">...</span>children</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> props <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> element<span class="token punctuation">.</span>props<span class="token punctuation">)</span>

  <span class="token keyword">let</span> defaultProps <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>element<span class="token punctuation">.</span>type <span class="token operator">&amp;&amp;</span> element<span class="token punctuation">.</span>type<span class="token punctuation">.</span>defaultProps<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    defaultProps <span class="token operator">=</span> element<span class="token punctuation">.</span>type<span class="token punctuation">.</span>defaultProps
  <span class="token punctuation">}</span>

  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> propName <span class="token keyword">in</span> config<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>propName <span class="token operator">!==</span> <span class="token string">&quot;key&quot;</span> <span class="token operator">&amp;&amp;</span> propName <span class="token operator">!==</span> <span class="token string">&quot;ref&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> val <span class="token operator">=</span> config<span class="token punctuation">[</span>propName<span class="token punctuation">]</span> <span class="token operator">||</span> defaultProps<span class="token punctuation">[</span>propName<span class="token punctuation">]</span>
      val <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>props<span class="token punctuation">[</span>propName<span class="token punctuation">]</span> <span class="token operator">=</span> val <span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  props<span class="token punctuation">.</span>children <span class="token operator">=</span> children<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">child</span> <span class="token operator">=&gt;</span> 
    <span class="token keyword">typeof</span> child <span class="token operator">==</span> <span class="token string">'object'</span> <span class="token operator">?</span> children <span class="token operator">:</span> <span class="token function">createTextNode</span><span class="token punctuation">(</span>child<span class="token punctuation">)</span>
  <span class="token punctuation">)</span>
    
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    key<span class="token operator">:</span> element<span class="token punctuation">.</span>key <span class="token operator">||</span> config<span class="token punctuation">.</span>key <span class="token operator">||</span> <span class="token string">''</span><span class="token punctuation">,</span>
    type<span class="token operator">:</span> element<span class="token punctuation">.</span>type<span class="token punctuation">,</span>
    props<span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/my-blog/zh/fontend/react/router.html" class="prev">
        React-router
      </a></span> <span class="next"><a href="/my-blog/zh/fontend/architecture/lifeCycle.html">
        生命周期
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/my-blog/assets/js/app.e4445ed3.js" defer></script><script src="/my-blog/assets/js/2.c20646db.js" defer></script><script src="/my-blog/assets/js/100.c40de34d.js" defer></script>
  </body>
</html>
